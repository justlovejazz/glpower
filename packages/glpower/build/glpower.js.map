{"version":3,"file":"glpower.js","sources":["../src/GLPowerVAO.ts","../src/GLPowerProgram.ts","../src/GLPowerBuffer.ts","../src/Math/Vector.ts","../src/GLPowerTexture.ts","../src/GLPowerFrameBuffer.ts","../src/Power.ts","../src/GLPowerTransformFeedback.ts","../src/Math/Matrix.ts","../src/Math/Quaternion.ts","../src/Geometries/Geometry.ts","../src/Geometries/CubeGeometry.ts","../src/Geometries/CylinderGeometry.ts","../src/Geometries/PlaneGeometry.ts","../src/Geometries/SphereGeometry.ts","../src/Geometries/TorusGeometry.ts","../src/Geometries/MipMapGeometry.ts","../src/ECS/index.ts","../src/utils/EventEmitter.ts","../src/ECS/System/index.ts","../src/Animation/Bezier.ts","../src/Animation/Easings.ts","../src/Animation/FCurve.ts","../src/Animation/FCurveGroup.ts","../src/Animation/FCurveKeyFrame.ts","../src/BLidge/index.ts","../src/utils/Uniform.ts"],"sourcesContent":["import { GLPowerBuffer } from \"./GLPowerBuffer\";\r\n\r\nexport type Attribute = {\r\n\tarray: number[];\r\n\tsize: number;\r\n}\r\n\r\ntype AttributeOptions = {\r\n\tinstanceDivisor?: number;\r\n}\r\n\r\nexport type AttributeBuffer = {\r\n\tbuffer: GLPowerBuffer;\r\n\tsize: number;\r\n\tcount: number;\r\n\tlocation?: number;\r\n} & AttributeOptions\r\n\r\nexport class GLPowerVAO {\r\n\r\n\tprivate gl: WebGL2RenderingContext;\r\n\r\n\tpublic vao: WebGLVertexArrayObject | null;\r\n\r\n\tpublic program: WebGLProgram;\r\n\r\n\tpublic indexBuffer: GLPowerBuffer | null;\r\n\r\n\tprotected attributes: Map<string, AttributeBuffer>;\r\n\r\n\tpublic vertCount: number;\r\n\tpublic indexCount: number;\r\n\r\n\tpublic instanceCount: number;\r\n\r\n\tconstructor( gl: WebGL2RenderingContext, program: WebGLProgram ) {\r\n\r\n\t\tthis.gl = gl;\r\n\r\n\t\tthis.program = program;\r\n\r\n\t\tthis.vao = this.gl.createVertexArray();\r\n\t\tthis.attributes = new Map();\r\n\t\tthis.indexBuffer = null;\r\n\r\n\t\tthis.vertCount = 0;\r\n\t\tthis.indexCount = 0;\r\n\t\tthis.instanceCount = 0;\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tAttribute\r\n\t-------------------------------*/\r\n\r\n\tpublic setAttribute( name: string, buffer: GLPowerBuffer, size: number, opt?: AttributeOptions ) {\r\n\r\n\t\tconst attr = this.attributes.get( name );\r\n\r\n\t\tconst count = buffer.array ? buffer.array.length / size : 0;\r\n\r\n\t\tthis.attributes.set( name, {\r\n\t\t\t...attr,\r\n\t\t\t...{\r\n\t\t\t\tbuffer,\r\n\t\t\t\tsize,\r\n\t\t\t\tcount,\r\n\t\t\t\t...opt\r\n\t\t\t},\r\n\t\t\tlocation: undefined\r\n\t\t} );\r\n\r\n\t\tthis.updateAttributes();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic removeAttribute( name: string ) {\r\n\r\n\t\tthis.attributes.delete( name );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic updateAttributes( force?: boolean ) {\r\n\r\n\t\tif ( ! this.vao ) return;\r\n\r\n\t\tthis.vertCount = 0;\r\n\t\tthis.instanceCount = 0;\r\n\r\n\t\tthis.gl.bindVertexArray( this.vao );\r\n\r\n\t\tthis.attributes.forEach( ( attribute, name ) => {\r\n\r\n\t\t\tif ( ( attribute.location === undefined || force ) ) {\r\n\r\n\t\t\t\tattribute.location = this.gl.getAttribLocation( this.program, name );\r\n\r\n\t\t\t\tif ( attribute.location > - 1 ) {\r\n\r\n\t\t\t\t\tthis.gl.bindBuffer( this.gl.ARRAY_BUFFER, attribute.buffer.buffer );\r\n\t\t\t\t\tthis.gl.enableVertexAttribArray( attribute.location );\r\n\t\t\t\t\tthis.gl.vertexAttribPointer( attribute.location, attribute.size, this.gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t\t\t\tif ( attribute.instanceDivisor !== undefined ) {\r\n\r\n\t\t\t\t\t\tthis.gl.vertexAttribDivisor( attribute.location, attribute.instanceDivisor );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.vertCount = Math.max( this.vertCount, attribute.count );\r\n\r\n\t\t\tif ( attribute.instanceDivisor !== undefined && attribute.instanceDivisor > 0 ) {\r\n\r\n\t\t\t\tif ( this.instanceCount == 0 ) {\r\n\r\n\t\t\t\t\tthis.instanceCount = attribute.count;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthis.instanceCount = Math.min( this.instanceCount, attribute.count );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tthis.gl.bindVertexArray( null );\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tIndex\r\n\t-------------------------------*/\r\n\r\n\tpublic setIndex( indexBuffer: GLPowerBuffer | null ) {\r\n\r\n\t\tthis.indexBuffer = indexBuffer;\r\n\r\n\t\tif ( ! this.vao ) return;\r\n\r\n\t\tthis.gl.bindVertexArray( this.vao );\r\n\r\n\t\tthis.gl.bindBuffer( this.gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer ? this.indexBuffer.buffer : null );\r\n\r\n\t\tthis.gl.bindVertexArray( null );\r\n\r\n\t\tif ( this.indexBuffer && this.indexBuffer.array ) {\r\n\r\n\t\t\tthis.indexCount = this.indexBuffer.array.length;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tUSE\r\n\t-------------------------------*/\r\n\r\n\tpublic use( cb?: ( vao: GLPowerVAO ) => void ) {\r\n\r\n\t\tthis.gl.bindVertexArray( this.vao );\r\n\r\n\t\tif ( cb ) cb( this );\r\n\r\n\t\tthis.gl.bindVertexArray( null );\r\n\r\n\t}\r\n\r\n\tpublic getVAO() {\r\n\r\n\t\treturn this.vao;\r\n\r\n\t}\r\n\r\n\tpublic dispose() {\r\n\r\n\t\tthis.attributes.forEach( item => {\r\n\r\n\t\t\titem.buffer.dispose();\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n}\r\n","import { Matrix } from \"./Math/Matrix\";\r\nimport { Vector } from \"./Math/Vector\";\r\nimport { GLPowerVAO } from \"./GLPowerVAO\";\r\nimport { GLPowerTexture } from \".\";\r\n\r\nexport type Uniformable = boolean | number | Vector | Matrix | GLPowerTexture;\r\n\r\nexport type UniformType =\r\n\t'1f' | '1fv' | '2f' | '2fv' | '3f' | '3fv' | '4f' | '4fv' |\r\n\t'1i' | '1iv' | '2i' | '2iv' | '3i' | '3iv' | '4i' | '4iv' |\r\n\t'Matrix2fv' | 'Matrix3fv' | 'Matrix4fv';\r\n\r\nexport type Uniform = {\r\n\tlocation: WebGLUniformLocation | null;\r\n\tvalue: ( number | boolean )[];\r\n\ttype: string;\r\n\tcache?: ( number | boolean )[];\r\n\tneedsUpdate?: boolean\r\n}\r\n\r\nexport type Uniforms = {[key:string]: {value: any, type: UniformType}}\r\n\r\nexport type ShaderOptions = {\r\n\ttransformFeedbackVaryings?: string[]\r\n}\r\n\r\nexport class GLPowerProgram {\r\n\r\n\tpublic gl: WebGL2RenderingContext;\r\n\tpublic program: WebGLProgram | null;\r\n\r\n\tprivate vao: Map<string, GLPowerVAO>;\r\n\tprotected uniforms: Map<string, Uniform>;\r\n\r\n\tconstructor( gl: WebGL2RenderingContext ) {\r\n\r\n\t\tthis.gl = gl;\r\n\r\n\t\tthis.program = this.gl.createProgram();\r\n\r\n\t\tthis.vao = new Map();\r\n\t\tthis.uniforms = new Map();\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tShader\r\n\t-------------------------------*/\r\n\r\n\tpublic setShader( vertexShaderSrc: string, fragmentShaderSrc: string, opt?: ShaderOptions ) {\r\n\r\n\t\tif ( this.program === null ) {\r\n\r\n\t\t\tconsole.warn( 'program is null.' );\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tconst vs = this.createShader( vertexShaderSrc, this.gl.VERTEX_SHADER );\r\n\t\tconst fs = this.createShader( fragmentShaderSrc, this.gl.FRAGMENT_SHADER );\r\n\r\n\t\tif ( ! vs || ! fs ) return;\r\n\r\n\t\tthis.gl.attachShader( this.program, vs );\r\n\t\tthis.gl.attachShader( this.program, fs );\r\n\r\n\t\tif ( opt && opt.transformFeedbackVaryings ) {\r\n\r\n\t\t\tthis.gl.transformFeedbackVaryings( this.program, opt.transformFeedbackVaryings, this.gl.SEPARATE_ATTRIBS );\r\n\r\n\t\t}\r\n\r\n\t\tthis.gl.linkProgram( this.program );\r\n\r\n\t\tif ( ! this.gl.getProgramParameter( this.program, this.gl.LINK_STATUS ) ) {\r\n\r\n\t\t\tconsole.error( 'program link error:', this.gl.getProgramInfoLog( this.program ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tprotected createShader( shaderSrc: string, type: number ) {\r\n\r\n\t\tconst shader = this.gl.createShader( type );\r\n\r\n\t\tif ( ! shader ) {\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\tthis.gl.shaderSource( shader, shaderSrc );\r\n\t\tthis.gl.compileShader( shader );\r\n\r\n\t\tif ( this.gl.getShaderParameter( shader, this.gl.COMPILE_STATUS ) ) {\r\n\r\n\t\t\treturn shader;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.error( this.gl.getShaderInfoLog( shader ) );\r\n\r\n\t\t\tlet error = '';\r\n\r\n\t\t\tshaderSrc.split( '\\n' ).forEach( ( t, i ) => {\r\n\r\n\t\t\t\terror += `${i + 1}: ${t}\\n`;\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tconsole.error( error );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tUniforms\r\n\t-------------------------------*/\r\n\r\n\tpublic setUniform( name: string, type: UniformType, value: ( number | boolean )[] ) {\r\n\r\n\t\tconst uniform = this.uniforms.get( name );\r\n\r\n\t\tif ( uniform ) {\r\n\r\n\t\t\tuniform.type = type;\r\n\t\t\tuniform.value = value;\r\n\r\n\t\t\tif ( uniform.cache ) {\r\n\r\n\t\t\t\tfor ( let i = 0; i < value.length; i ++ ) {\r\n\r\n\t\t\t\t\tif ( uniform.cache[ i ] !== value[ i ] ) {\r\n\r\n\t\t\t\t\t\tuniform.needsUpdate = true;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tuniform.needsUpdate = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.uniforms.set( name, {\r\n\t\t\t\tvalue,\r\n\t\t\t\ttype: type,\r\n\t\t\t\tlocation: null,\r\n\t\t\t\tneedsUpdate: true\r\n\t\t\t} );\r\n\r\n\t\t\tthis.updateUniformLocations();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tprivate updateUniformLocations( force?: boolean ) {\r\n\r\n\t\tif ( ! this.program ) return;\r\n\r\n\t\tthis.uniforms.forEach( ( uniform, key ) => {\r\n\r\n\t\t\tif ( uniform.location === null || force ) {\r\n\r\n\t\t\t\tuniform.location = this.gl.getUniformLocation( this.program!, key );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tpublic uploadUniforms() {\r\n\r\n\t\tthis.uniforms.forEach( uniform => {\r\n\r\n\t\t\tif ( uniform.needsUpdate ) {\r\n\r\n\t\t\t\tif ( /Matrix[2|3|4]fv/.test( uniform.type ) ) {\r\n\r\n\t\t\t\t\t( this.gl as any )[ 'uniform' + uniform.type ]( uniform.location, false, uniform.value );\r\n\r\n\t\t\t\t} else if ( /[1|2|3|4][f|i]$/.test( uniform.type ) ) {\r\n\r\n\t\t\t\t\t( this.gl as any )[ 'uniform' + uniform.type ]( uniform.location, ...uniform.value );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t( this.gl as any )[ 'uniform' + uniform.type ]( uniform.location, uniform.value );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tuniform.cache = uniform.value.concat();\r\n\t\t\t\tuniform.needsUpdate = false;\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tVAO\r\n\t-------------------------------*/\r\n\r\n\tpublic getVAO( id: string = '_' ) {\r\n\r\n\t\tif ( ! this.program ) return null;\r\n\r\n\t\tlet vao = this.vao.get( id );\r\n\r\n\t\tif ( vao ) return vao;\r\n\r\n\t\tvao = new GLPowerVAO( this.gl, this.program );\r\n\r\n\t\tthis.vao.set( id, vao );\r\n\r\n\t\treturn vao;\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tDraw??\r\n\t-------------------------------*/\r\n\r\n\tpublic use( cb?: ( program: GLPowerProgram ) => void ) {\r\n\r\n\t\tif ( ! this.program ) return;\r\n\r\n\t\tthis.gl.useProgram( this.program );\r\n\r\n\t\tif ( cb ) {\r\n\r\n\t\t\tcb( this );\r\n\r\n\t\t}\r\n\r\n\t\tthis.gl.useProgram( null );\r\n\r\n\t}\r\n\r\n\tpublic getProgram() {\r\n\r\n\t\treturn this.program;\r\n\r\n\t}\r\n\r\n\tpublic dispose() {\r\n\r\n\t\tthis.vao.forEach( vao => {\r\n\r\n\t\t\tvao.dispose();\r\n\r\n\t\t} );\r\n\r\n\t\tthis.vao.clear();\r\n\r\n\t\tthis.gl.deleteProgram( this.program );\r\n\r\n\t}\r\n\r\n}\r\n","export type BufferType = 'vbo' | 'ibo';\r\nexport type TArrayBuffer = Uint8Array | Uint16Array | Uint32Array | Float32Array | Float64Array\r\n\r\nexport class GLPowerBuffer {\r\n\r\n\tprivate gl: WebGL2RenderingContext;\r\n\tpublic buffer: WebGLBuffer | null;\r\n\tpublic array: TArrayBuffer | null;\r\n\r\n\tconstructor( gl: WebGL2RenderingContext ) {\r\n\r\n\t\tthis.gl = gl;\r\n\r\n\t\tthis.buffer = this.gl.createBuffer();\r\n\r\n\t\tthis.array = null;\r\n\r\n\t}\r\n\r\n\tpublic setData( data: TArrayBuffer, type: BufferType = 'vbo', usage?: number ) {\r\n\r\n\t\tconst target = type == 'vbo' ? this.gl.ARRAY_BUFFER : this.gl.ELEMENT_ARRAY_BUFFER;\r\n\r\n\t\tthis.gl.bindBuffer( target, this.buffer );\r\n\r\n\t\tthis.gl.bufferData( target, data, usage || this.gl.STATIC_DRAW );\r\n\r\n\t\tthis.gl.bindBuffer( target, null );\r\n\r\n\t\tthis.array = data;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic dispose() {\r\n\r\n\t\tthis.gl.deleteBuffer( this.buffer );\r\n\r\n\t}\r\n\r\n}\r\n","import { Matrix, Types } from \"..\";\r\n\r\nexport type IVector2 = {\r\n\tx: number,\r\n\ty: number,\r\n}\r\n\r\nexport type IVector3 = IVector2 & {\r\n\tz: number,\r\n}\r\n\r\nexport type IVector4 = IVector3 & {\r\n\tw: number,\r\n}\r\n\r\nexport class Vector {\r\n\r\n\tpublic x: number;\r\n\tpublic y: number;\r\n\tpublic z: number;\r\n\tpublic w: number;\r\n\r\n\tconstructor( x?: number, y?: number, z?: number, w?: number ) {\r\n\r\n\t\tthis.x = x || 0;\r\n\t\tthis.y = y || 0;\r\n\t\tthis.z = z || 0;\r\n\t\tthis.w = w || 0;\r\n\r\n\t}\r\n\r\n\tpublic get isVector() {\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\tpublic set( x: number, y?: number, z?: number, w?: number ) {\r\n\r\n\t\tthis.x = x;\r\n\t\tthis.y = y ?? this.y;\r\n\t\tthis.z = z ?? this.z;\r\n\t\tthis.w = w ?? this.w;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic add( a: number ): Vector\r\n\r\n\tpublic add( a: Vector | Types.Nullable<IVector4> ): Vector\r\n\r\n\tpublic add( a: Vector | Types.Nullable<IVector4> | number ): Vector {\r\n\r\n\t\tif ( typeof a == 'number' ) {\r\n\r\n\t\t\tthis.x += a;\r\n\t\t\tthis.y += a;\r\n\t\t\tthis.z += a;\r\n\t\t\tthis.w += a;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.x += a.x ?? 0;\r\n\t\t\tthis.y += a.y ?? 0;\r\n\t\t\tthis.z += a.z ?? 0;\r\n\t\t\tthis.w += a.w ?? 0;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic sub( a: number ): Vector\r\n\r\n\tpublic sub( a: Vector | Types.Nullable<IVector4> ): Vector\r\n\r\n\tpublic sub( a: Vector | Types.Nullable<IVector4> | number ) {\r\n\r\n\t\tif ( typeof ( a ) == 'number' ) {\r\n\r\n\t\t\tthis.x -= a;\r\n\t\t\tthis.y -= a;\r\n\t\t\tthis.z -= a;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.x -= a.x ?? 0;\r\n\t\t\tthis.y -= a.y ?? 0;\r\n\t\t\tthis.z -= a.z ?? 0;\r\n\t\t\tthis.w -= a.w ?? 0;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic multiply( a: number ): Vector;\r\n\r\n\tpublic multiply( a: Vector ): Vector;\r\n\r\n\tpublic multiply( a: number | Vector ) {\r\n\r\n\t\tif ( typeof a == 'number' ) {\r\n\r\n\t\t\tthis.x *= a;\r\n\t\t\tthis.y *= a;\r\n\t\t\tthis.z *= a;\r\n\t\t\tthis.w *= a;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.x *= a.x;\r\n\t\t\tthis.y *= a.y;\r\n\t\t\tthis.z *= a.z;\r\n\t\t\tthis.w *= a.w;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic divide( a: number ): Vector;\r\n\r\n\tpublic divide( a: Vector ): Vector;\r\n\r\n\tpublic divide( a: number | Vector ) {\r\n\r\n\t\tif ( typeof a == 'number' ) {\r\n\r\n\t\t\tthis.x /= a;\r\n\t\t\tthis.y /= a;\r\n\t\t\tthis.z /= a;\r\n\t\t\tthis.w /= a;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.x /= a.x;\r\n\t\t\tthis.y /= a.y;\r\n\t\t\tthis.z /= a.z;\r\n\t\t\tthis.w /= a.w;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic length() {\r\n\r\n\t\treturn Math.sqrt( this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w );\r\n\r\n\t}\r\n\r\n\tpublic normalize() {\r\n\r\n\t\treturn this.divide( this.length() || 1 );\r\n\r\n\t}\r\n\r\n\tpublic cross( v: Vector | IVector3 ) {\r\n\r\n\t\tconst ax = this.x, ay = this.y, az = this.z;\r\n\t\tconst bx = v.x, by = v.y, bz = v.z;\r\n\r\n\t\tthis.x = ay * bz - az * by;\r\n\t\tthis.y = az * bx - ax * bz;\r\n\t\tthis.z = ax * by - ay * bx;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic dot( v: Vector | IVector3 ) {\r\n\r\n\t\treturn this.x * v.x + this.y * v.y + this.z * v.z;\r\n\r\n\t}\r\n\r\n\tpublic applyMatrix3( mat: Matrix ) {\r\n\r\n\t\tconst elm = mat.elm;\r\n\r\n\t\tconst e11 = elm[ 0 ], e12 = elm[ 1 ], e13 = elm[ 2 ],\r\n\t\t\te21 = elm[ 4 ], e22 = elm[ 5 ], e23 = elm[ 6 ],\r\n\t\t\te31 = elm[ 8 ], e32 = elm[ 9 ], e33 = elm[ 10 ];\r\n\r\n\t\t// const xx = this.x * e11 + this.y * e12 + this.z * e13;\r\n\t\t// const yy = this.x * e21 + this.y * e22 + this.z * e23;\r\n\t\t// const zz = this.x * e31 + this.y * e32 + this.z * e33;\r\n\r\n\t\tconst xx = this.x * e11 + this.y * e21 + this.z * e31;\r\n\t\tconst yy = this.x * e12 + this.y * e22 + this.z * e32;\r\n\t\tconst zz = this.x * e13 + this.y * e23 + this.z * e33;\r\n\r\n\t\tthis.x = xx;\r\n\t\tthis.y = yy;\r\n\t\tthis.z = zz;\r\n\t\tthis.w = 0;\r\n\r\n\t}\r\n\r\n\tpublic applyMatrix4( mat: Matrix ) {\r\n\r\n\t\tconst elm = mat.elm;\r\n\r\n\t\tconst e11 = elm[ 0 ], e12 = elm[ 1 ], e13 = elm[ 2 ], e14 = elm[ 3 ],\r\n\t\t\te21 = elm[ 4 ], e22 = elm[ 5 ], e23 = elm[ 6 ], e24 = elm[ 7 ],\r\n\t\t\te31 = elm[ 8 ], e32 = elm[ 9 ], e33 = elm[ 10 ], e34 = elm[ 11 ],\r\n\t\t\te41 = elm[ 12 ], e42 = elm[ 13 ], e43 = elm[ 14 ], e44 = elm[ 15 ];\r\n\r\n\t\tconst xx = this.x * e11 + this.y * e21 + this.z * e31 + this.w * e41;\r\n\t\tconst yy = this.x * e12 + this.y * e22 + this.z * e32 + this.w * e42;\r\n\t\tconst zz = this.x * e13 + this.y * e23 + this.z * e33 + this.w * e43;\r\n\t\tconst ww = this.x * e14 + this.y * e24 + this.z * e34 + this.w * e44;\r\n\r\n\t\tthis.x = xx;\r\n\t\tthis.y = yy;\r\n\t\tthis.z = zz;\r\n\t\tthis.w = ww;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic copy( a: Vector | Types.Nullable<IVector4> ) {\r\n\r\n\t\tthis.x = a.x ?? 0;\r\n\t\tthis.y = a.y ?? 0;\r\n\t\tthis.z = a.z ?? 0;\r\n\t\tthis.w = a.w ?? 0;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic clone() {\r\n\r\n\t\treturn new Vector( this.x, this.y, this.z, this.w );\r\n\r\n\t}\r\n\r\n\tpublic getElm( type?: 'vec2' | 'vec3' | 'vec4' ) {\r\n\r\n\t\tif ( type == 'vec2' ) {\r\n\r\n\t\t\treturn [ this.x, this.y ];\r\n\r\n\t\t} else if ( type == 'vec3' ) {\r\n\r\n\t\t\treturn [ this.x, this.y, this.z ];\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn [ this.x, this.y, this.z, this.w ];\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n","import { Vector } from \"./Math/Vector\";\r\nimport { Types } from \"./types\";\r\n\r\ntype ImagePretense = {\r\n\twidth: number,\r\n\theight: number\r\n}\r\n\r\ntype GLPowerTextureSetting = {\r\n\ttype: number,\r\n\tinternalFormat: number,\r\n\tformat: number,\r\n\tmagFilter: number,\r\n\tminFilter: number,\r\n\tgenerateMipmap: boolean,\r\n\twrapS: number,\r\n\twrapT: number,\r\n}\r\n\r\nexport class GLPowerTexture {\r\n\r\n\tpublic unit: number;\r\n\tpublic image: HTMLImageElement | ImagePretense | null;\r\n\tpublic size: Vector;\r\n\r\n\tprivate gl: WebGL2RenderingContext;\r\n\tprivate texture: WebGLTexture | null;\r\n\r\n\tprivate _setting: GLPowerTextureSetting;\r\n\r\n\tconstructor( gl: WebGL2RenderingContext ) {\r\n\r\n\t\tthis.gl = gl;\r\n\t\tthis.image = null;\r\n\t\tthis.unit = 0;\r\n\t\tthis.size = new Vector();\r\n\t\tthis.texture = this.gl.createTexture();\r\n\r\n\t\tthis._setting = {\r\n\t\t\ttype: this.gl.UNSIGNED_BYTE,\r\n\t\t\tinternalFormat: this.gl.RGBA,\r\n\t\t\tformat: this.gl.RGBA,\r\n\t\t\tmagFilter: this.gl.NEAREST,\r\n\t\t\tminFilter: this.gl.NEAREST,\r\n\t\t\tgenerateMipmap: false,\r\n\t\t\twrapS: this.gl.CLAMP_TO_EDGE,\r\n\t\t\twrapT: this.gl.CLAMP_TO_EDGE,\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tpublic get isTexture() {\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\tpublic setting( param: Types.Nullable<GLPowerTextureSetting> ) {\r\n\r\n\t\tthis._setting = {\r\n\t\t\t...this._setting,\r\n\t\t\t...param\r\n\t\t};\r\n\r\n\t\tthis.attach( this.image );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic attach( img: HTMLImageElement | ImagePretense | null ) {\r\n\r\n\t\tthis.image = img;\r\n\r\n\t\tthis.gl.bindTexture( this.gl.TEXTURE_2D, this.texture );\r\n\r\n\t\tif ( this.image ) {\r\n\r\n\t\t\tthis.size.set( this.image.width, this.image.height );\r\n\r\n\t\t\tif ( this.image instanceof HTMLImageElement ) {\r\n\r\n\t\t\t\tthis.gl.texImage2D( this.gl.TEXTURE_2D, 0, this._setting.internalFormat, this._setting.format, this._setting.type, this.image );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.gl.texImage2D( this.gl.TEXTURE_2D, 0, this._setting.internalFormat, this.image.width, this.image.height, 0, this._setting.format, this._setting.type, null );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.size.set( 1, 1 );\r\n\r\n\t\t\tthis.gl.texImage2D( this.gl.TEXTURE_2D, 0, this._setting.internalFormat, this.size.x, this.size.y, 0, this._setting.format, this._setting.type, null );\r\n\r\n\t\t}\r\n\r\n\t\tthis.gl.texParameteri( this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this._setting.magFilter );\r\n\t\tthis.gl.texParameteri( this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this._setting.minFilter );\r\n\t\tthis.gl.texParameterf( this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this._setting.wrapS );\r\n\t\tthis.gl.texParameterf( this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this._setting.wrapT );\r\n\r\n\t\tif ( this._setting.generateMipmap ) {\r\n\r\n\t\t\tthis.gl.generateMipmap( this.gl.TEXTURE_2D );\r\n\r\n\t\t}\r\n\r\n\t\tthis.gl.bindTexture( this.gl.TEXTURE_2D, null );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic activate( unitNumber: number ) {\r\n\r\n\t\tthis.gl.activeTexture( this.gl.TEXTURE0 + unitNumber );\r\n\t\tthis.gl.bindTexture( this.gl.TEXTURE_2D, this.texture );\r\n\r\n\t\tthis.unit = unitNumber;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic load( src: string, callBack?: () => void ) {\r\n\r\n\t\tconst img = new Image();\r\n\r\n\t\timg.onload = () => {\r\n\r\n\t\t\tthis.attach( img );\r\n\r\n\t\t\tif ( callBack ) callBack();\r\n\r\n\t\t};\r\n\r\n\t\timg.src = src;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic getTexture() {\r\n\r\n\t\treturn this.texture;\r\n\r\n\t}\r\n\r\n\tpublic loadAsync( src: string ) {\r\n\r\n\t\treturn new Promise( ( resolve, reject ) => {\r\n\r\n\t\t\tconst img = new Image();\r\n\r\n\t\t\timg.onload = () => {\r\n\r\n\t\t\t\tthis.attach( img );\r\n\r\n\t\t\t\tresolve( this );\r\n\r\n\t\t\t};\r\n\r\n\t\t\timg.onerror = () => {\r\n\r\n\t\t\t\treject( 'img error, ' + src );\r\n\r\n\t\t\t};\r\n\r\n\t\t\timg.src = src;\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tpublic dispose() {\r\n\r\n\t\tthis.gl.deleteTexture( this.texture );\r\n\r\n\t}\r\n\r\n}\r\n","import { GLPowerTexture } from \"./GLPowerTexture\";\r\nimport { Vector } from \"./Math/Vector\";\r\n\r\nexport type GLPowerFrameBfferOpt = {\r\n\tdisableDepthBuffer?: boolean\r\n}\r\n\r\nexport class GLPowerFrameBuffer {\r\n\r\n\tpublic size: Vector;\r\n\r\n\tprivate gl: WebGL2RenderingContext;\r\n\tpublic frameBuffer: WebGLFramebuffer | null;\r\n\tpublic depthRenderBuffer: WebGLRenderbuffer | null;\r\n\r\n\tpublic textures: GLPowerTexture[];\r\n\tpublic textureAttachmentList: number[];\r\n\r\n\tconstructor( gl: WebGL2RenderingContext, opt?: GLPowerFrameBfferOpt ) {\r\n\r\n\t\tthis.gl = gl;\r\n\r\n\t\tthis.size = new Vector( 1, 1 );\r\n\r\n\t\tthis.frameBuffer = this.gl.createFramebuffer();\r\n\t\tthis.depthRenderBuffer = null;\r\n\r\n\t\tthis.textures = [];\r\n\t\tthis.textureAttachmentList = [];\r\n\r\n\t\tif ( ! opt || ! opt.disableDepthBuffer ) {\r\n\r\n\t\t\tthis.setDepthBuffer( this.gl.createRenderbuffer() );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic setDepthBuffer( renderBuffer: WebGLRenderbuffer | null ) {\r\n\r\n\t\t// depth buffer\r\n\r\n\t\tthis.depthRenderBuffer = renderBuffer;\r\n\t\tthis.gl.bindRenderbuffer( this.gl.RENDERBUFFER, this.depthRenderBuffer );\r\n\t\tthis.gl.bindFramebuffer( this.gl.FRAMEBUFFER, this.frameBuffer );\r\n\t\tthis.gl.framebufferRenderbuffer( this.gl.FRAMEBUFFER, this.gl.DEPTH_ATTACHMENT, this.gl.RENDERBUFFER, this.depthRenderBuffer );\r\n\t\tthis.gl.bindFramebuffer( this.gl.FRAMEBUFFER, null );\r\n\t\tthis.gl.bindRenderbuffer( this.gl.RENDERBUFFER, null );\r\n\r\n\t}\r\n\r\n\tpublic setTexture( textures: GLPowerTexture[] ) {\r\n\r\n\t\tthis.textures = textures;\r\n\t\tthis.textureAttachmentList.length = 0;\r\n\r\n\t\tthis.gl.bindFramebuffer( this.gl.FRAMEBUFFER, this.frameBuffer );\r\n\r\n\t\tthis.textures.forEach( ( t, i ) => {\r\n\r\n\t\t\tt.attach( { width: this.size.x, height: this.size.y } );\r\n\r\n\t\t\tthis.gl.bindTexture( this.gl.TEXTURE_2D, t.getTexture() );\r\n\t\t\tthis.gl.texParameteri( this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.LINEAR );\r\n\t\t\tthis.gl.texParameteri( this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.LINEAR );\r\n\t\t\tthis.gl.bindTexture( this.gl.TEXTURE_2D, null );\r\n\r\n\t\t\tconst attachment = this.gl.COLOR_ATTACHMENT0 + i;\r\n\t\t\tthis.gl.framebufferTexture2D( this.gl.FRAMEBUFFER, attachment, this.gl.TEXTURE_2D, t.getTexture(), 0 );\r\n\r\n\t\t\tthis.textureAttachmentList.push( attachment );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.gl.bindFramebuffer( this.gl.FRAMEBUFFER, null );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic setSize( size: Vector ): void\r\n\r\n\tpublic setSize( width: number, height: number ) : void\r\n\r\n\tpublic setSize( width_size: number | Vector, height?: number ) {\r\n\r\n\t\tif ( typeof width_size == 'number' ) {\r\n\r\n\t\t\tthis.size.x = width_size;\r\n\r\n\t\t\tif ( height !== undefined ) {\r\n\r\n\t\t\t\tthis.size.y = height;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.size.copy( width_size );\r\n\r\n\t\t}\r\n\r\n\t\tthis.setTexture( this.textures );\r\n\r\n\t\tthis.textures.forEach( t => {\r\n\r\n\t\t\tt.attach( { width: this.size.x, height: this.size.y } );\r\n\r\n\t\t} );\r\n\r\n\t\tif ( this.depthRenderBuffer ) {\r\n\r\n\t\t\tthis.gl.bindRenderbuffer( this.gl.RENDERBUFFER, this.depthRenderBuffer );\r\n\t\t\tthis.gl.renderbufferStorage( this.gl.RENDERBUFFER, this.gl.DEPTH_COMPONENT32F, this.size.x, this.size.y );\r\n\t\t\tthis.gl.bindRenderbuffer( this.gl.RENDERBUFFER, null );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic getFrameBuffer() {\r\n\r\n\t\treturn this.frameBuffer;\r\n\r\n\t}\r\n\r\n\tpublic dispose() {\r\n\r\n\t\tthis.gl.deleteFramebuffer( this.frameBuffer );\r\n\t\tthis.gl.deleteRenderbuffer( this.depthRenderBuffer );\r\n\r\n\t}\r\n\r\n}\r\n","import { GLPowerProgram } from \"./GLPowerProgram\";\r\nimport { GLPowerBuffer } from \"./GLPowerBuffer\";\r\nimport { GLPowerTexture } from \"./GLPowerTexture\";\r\nimport { GLPowerFrameBuffer } from \"./GLPowerFrameBuffer\";\r\n\r\nexport class Power {\r\n\r\n\tpublic gl: WebGL2RenderingContext;\r\n\r\n\tpublic extDisJointTimerQuery: any;\r\n\r\n\tconstructor( gl: WebGL2RenderingContext ) {\r\n\r\n\t\tthis.gl = gl;\r\n\r\n\t\tthis.gl.pixelStorei( gl.UNPACK_FLIP_Y_WEBGL, true );\r\n\r\n\t\tthis.gl.getExtension( \"EXT_color_buffer_float\" );\r\n\t\tthis.gl.getExtension( \"EXT_color_buffer_half_float\" );\r\n\t\tthis.extDisJointTimerQuery = this.gl.getExtension( \"EXT_disjoint_timer_query_webgl2\" );\r\n\r\n\t}\r\n\r\n\tpublic createProgram() {\r\n\r\n\t\tconst program = new GLPowerProgram( this.gl );\r\n\r\n\t\treturn program;\r\n\r\n\t}\r\n\r\n\tpublic createBuffer() {\r\n\r\n\t\tconst vertexBuffer = new GLPowerBuffer( this.gl );\r\n\r\n\t\treturn vertexBuffer;\r\n\r\n\t}\r\n\r\n\tpublic createTexture() {\r\n\r\n\t\tconst texture = new GLPowerTexture( this.gl );\r\n\r\n\t\treturn texture;\r\n\r\n\t}\r\n\r\n\tpublic createFrameBuffer() {\r\n\r\n\t\tconst frameBuffer = new GLPowerFrameBuffer( this.gl );\r\n\r\n\t\treturn frameBuffer;\r\n\r\n\t}\r\n\r\n}\r\n\r\n","import { GLPowerBuffer } from \"./GLPowerBuffer\";\r\n\r\nexport class GLPowerTransformFeedback {\r\n\r\n\tprivate gl: WebGL2RenderingContext;\r\n\tprivate transformFeedback: WebGLTransformFeedback | null;\r\n\r\n\tprotected feedbackBuffer: Map<string, {buffer: GLPowerBuffer, varyingIndex: number}>;\r\n\r\n\tconstructor( gl: WebGL2RenderingContext ) {\r\n\r\n\t\tthis.gl = gl;\r\n\t\tthis.transformFeedback = this.gl.createTransformFeedback();\r\n\r\n\t\tthis.feedbackBuffer = new Map();\r\n\r\n\t}\r\n\r\n\tpublic bind( cb?: () => void ) {\r\n\r\n\t\tthis.gl.bindTransformFeedback( this.gl.TRANSFORM_FEEDBACK, this.transformFeedback );\r\n\r\n\t\tif ( cb ) cb();\r\n\r\n\t\tthis.gl.bindTransformFeedback( this.gl.TRANSFORM_FEEDBACK, null );\r\n\r\n\t}\r\n\r\n\tpublic setBuffer( name: string, buffer: GLPowerBuffer, varyingIndex: number ) {\r\n\r\n\t\tthis.feedbackBuffer.set( name, {\r\n\t\t\tbuffer,\r\n\t\t\tvaryingIndex\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tpublic use( cb?: ( tf: GLPowerTransformFeedback ) => void ) {\r\n\r\n\t\tthis.bind( () => {\r\n\r\n\t\t\tthis.feedbackBuffer.forEach( fbBuffer => {\r\n\r\n\t\t\t\tthis.gl.bindBufferBase( this.gl.TRANSFORM_FEEDBACK_BUFFER, fbBuffer.varyingIndex, fbBuffer.buffer.buffer );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tif ( cb ) cb( this );\r\n\r\n\t\t\tthis.feedbackBuffer.forEach( fbBuffer => {\r\n\r\n\t\t\t\tthis.gl.bindBufferBase( this.gl.TRANSFORM_FEEDBACK_BUFFER, fbBuffer.varyingIndex, null );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n}\r\n","import { IVector4 } from \"..\";\r\nimport { Quaternion } from \"./Quaternion\";\r\nimport { IVector3, Vector } from \"./Vector\";\r\n\r\nexport class Matrix {\r\n\r\n\tpublic elm: number[];\r\n\r\n\tconstructor( elm?: number [] ) {\r\n\r\n\t\tthis.elm = [\r\n\t\t\t1, 0, 0, 0,\r\n\t\t\t0, 1, 0, 0,\r\n\t\t\t0, 0, 1, 0,\r\n\t\t\t0, 0, 0, 1,\r\n\t\t];\r\n\r\n\t\tif ( elm ) {\r\n\r\n\t\t\tthis.set( elm );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic identity() {\r\n\r\n\t\tthis.elm = [\r\n\t\t\t1, 0, 0, 0,\r\n\t\t\t0, 1, 0, 0,\r\n\t\t\t0, 0, 1, 0,\r\n\t\t\t0, 0, 0, 1,\r\n\t\t];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic clone() {\r\n\r\n\t\treturn new Matrix().copy( this );\r\n\r\n\t}\r\n\r\n\tpublic copy( mat: Matrix ) {\r\n\r\n\t\tthis.set( mat.elm );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic perspective( fov: number, aspect: number, near: number, far: number ) {\r\n\r\n\t\tvar r = 1 / Math.tan( fov * Math.PI / 360 );\r\n\t\tvar d = far - near;\r\n\r\n\t\tthis.elm = [\r\n\t\t\tr / aspect, 0, 0, 0,\r\n\t\t\t0, r, 0, 0,\r\n\t\t\t0, 0, - ( far + near ) / d, - 1,\r\n\t\t\t0, 0, - ( far * near * 2 ) / d, 0\r\n\t\t];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic orthographic( width: number, height: number, near: number, far: number ) {\r\n\r\n\t\tthis.elm = [\r\n\t\t\t2 / width, 0, 0, 0,\r\n\t\t\t0, 2 / height, 0, 0,\r\n\t\t\t0, 0, - 2 / ( far - near ), 0,\r\n\t\t\t0, 0, - ( far + near ) / ( far - near ), 1,\r\n\t\t];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic lookAt( eye: Vector, target: Vector, up: Vector ) {\r\n\r\n\t\tconst zAxis = eye.clone().sub( target ).normalize();\r\n\t\tconst xAxis = up.clone().cross( zAxis ).normalize();\r\n\t\tconst yAxis = zAxis.clone().cross( xAxis ).normalize();\r\n\r\n\t\tthis.elm = [\r\n\t\t   xAxis.x, xAxis.y, xAxis.z, 0,\r\n\t\t   yAxis.x, yAxis.y, yAxis.z, 0,\r\n\t\t   zAxis.x, zAxis.y, zAxis.z, 0,\r\n\t\t   eye.x,\r\n\t\t   eye.y,\r\n\t\t   eye.z,\r\n\t\t   1,\r\n\t\t];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic inverse() {\r\n\r\n\t\tconst a = this.elm[ 0 ], b = this.elm[ 1 ], c = this.elm[ 2 ], d = this.elm[ 3 ],\r\n\t\t\t  e = this.elm[ 4 ], f = this.elm[ 5 ], g = this.elm[ 6 ], h = this.elm[ 7 ],\r\n\t\t\t  i = this.elm[ 8 ], j = this.elm[ 9 ], k = this.elm[ 10 ], l = this.elm[ 11 ],\r\n\t\t\t  m = this.elm[ 12 ], n = this.elm[ 13 ], o = this.elm[ 14 ], p = this.elm[ 15 ],\r\n\t\t\tq = a * f - b * e, r = a * g - c * e,\r\n\t\t\ts = a * h - d * e, t = b * g - c * f,\r\n\t\t\tu = b * h - d * f, v = c * h - d * g,\r\n\t\t\tw = i * n - j * m, x = i * o - k * m,\r\n\t\t\ty = i * p - l * m, z = j * o - k * n,\r\n\t\t\tA = j * p - l * n, B = k * p - l * o,\r\n\t\t\tdet = ( q * B - r * A + s * z + t * y - u * x + v * w ),\r\n\t\t\tivd = 1 / det;\r\n\r\n\t\tif ( det == 0 ) return this.identity();\r\n\r\n\t\tthis.elm[ 0 ] = ( f * B - g * A + h * z ) * ivd;\r\n\t\tthis.elm[ 1 ] = ( - b * B + c * A - d * z ) * ivd;\r\n\t\tthis.elm[ 2 ] = ( n * v - o * u + p * t ) * ivd;\r\n\t\tthis.elm[ 3 ] = ( - j * v + k * u - l * t ) * ivd;\r\n\t\tthis.elm[ 4 ] = ( - e * B + g * y - h * x ) * ivd;\r\n\t\tthis.elm[ 5 ] = ( a * B - c * y + d * x ) * ivd;\r\n\t\tthis.elm[ 6 ] = ( - m * v + o * s - p * r ) * ivd;\r\n\t\tthis.elm[ 7 ] = ( i * v - k * s + l * r ) * ivd;\r\n\t\tthis.elm[ 8 ] = ( e * A - f * y + h * w ) * ivd;\r\n\t\tthis.elm[ 9 ] = ( - a * A + b * y - d * w ) * ivd;\r\n\t\tthis.elm[ 10 ] = ( m * u - n * s + p * q ) * ivd;\r\n\t\tthis.elm[ 11 ] = ( - i * u + j * s - l * q ) * ivd;\r\n\t\tthis.elm[ 12 ] = ( - e * z + f * x - g * w ) * ivd;\r\n\t\tthis.elm[ 13 ] = ( a * z - b * x + c * w ) * ivd;\r\n\t\tthis.elm[ 14 ] = ( - m * t + n * r - o * q ) * ivd;\r\n\t\tthis.elm[ 15 ] = ( i * t - j * r + k * q ) * ivd;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic transpose() {\r\n\r\n\t\tconst e11 = this.elm[ 0 ], e12 = this.elm[ 1 ], e13 = this.elm[ 2 ], e14 = this.elm[ 3 ],\r\n\t\t\te21 = this.elm[ 4 ], e22 = this.elm[ 5 ], e23 = this.elm[ 6 ], e24 = this.elm[ 7 ],\r\n\t\t\te31 = this.elm[ 8 ], e32 = this.elm[ 9 ], e33 = this.elm[ 10 ], e34 = this.elm[ 11 ],\r\n\t\t\te41 = this.elm[ 12 ], e42 = this.elm[ 13 ], e43 = this.elm[ 14 ], e44 = this.elm[ 15 ];\r\n\r\n\t\tthis.elm[ 0 ] = e11; this.elm[ 1 ] = e21; this.elm[ 2 ] = e31; this.elm[ 3 ] = e41;\r\n\t\tthis.elm[ 4 ] = e12; this.elm[ 5 ] = e22; this.elm[ 6 ] = e32; this.elm[ 7 ] = e42;\r\n\t\tthis.elm[ 8 ] = e13; this.elm[ 9 ] = e23; this.elm[ 10 ] = e33; this.elm[ 11 ] = e43;\r\n\t\tthis.elm[ 12 ] = e14; this.elm[ 13 ] = e24; this.elm[ 14 ] = e34; this.elm[ 15 ] = e44;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic set( elm: number[] ) {\r\n\r\n\t\tfor ( let i = 0; i < this.elm.length; i ++ ) {\r\n\r\n\t\t\tthis.elm[ i ] = elm[ i ] ?? 0;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic setFromTransform( pos: IVector3, qua: Quaternion | IVector4, scale: IVector3 ) {\r\n\r\n\t\tthis.identity();\r\n\r\n\t\tthis.applyPosition( pos );\r\n\r\n\t\tthis.applyQuaternion( qua );\r\n\r\n\t\tthis.applyScale( scale );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic applyPosition( position: IVector3 ) {\r\n\r\n\t\tthis.matmul( [\r\n\t\t\t1, 0, 0, 0,\r\n\t\t\t0, 1, 0, 0,\r\n\t\t\t0, 0, 1, 0,\r\n\t\t\tposition.x, position.y, position.z, 1\r\n\t\t] );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic applyQuaternion( q: Quaternion | IVector4 ) {\r\n\r\n\t\tconst x = q.x, y = q.y, z = q.z, w = q.w;\r\n\t\tconst xx = x * x, yy = y * y, zz = z * z, ww = w * w;\r\n\t\tconst xy = x * y, xz = x * z, xw = x * w, yz = y * z, yw = y * w, zw = z * w;\r\n\r\n\t\tthis.matmul( [\r\n\t\t\txx - yy - zz + ww,\r\n\t\t\t2 * ( xy + zw ),\r\n\t\t\t2 * ( xz - yw ),\r\n\t\t\t0,\r\n\r\n\t\t\t2 * ( xy - zw ),\r\n\t\t\t- xx + yy - zz + ww,\r\n\t\t\t2 * ( yz + xw ),\r\n\t\t\t0,\r\n\r\n\t\t\t2 * ( xz + yw ),\r\n\t\t\t2 * ( yz - xw ),\r\n\t\t\t- xx - yy + zz + ww,\r\n\r\n\t\t\t0, 0, 0, 0, 1\r\n\t\t] );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic applyScale( scale: IVector3 ) {\r\n\r\n\t\tthis.matmul( [\r\n\t\t\tscale.x, 0, 0, 0,\r\n\t\t\t0, scale.y, 0, 0,\r\n\t\t\t0, 0, scale.z, 0,\r\n\t\t\t0, 0, 0, 1\r\n\t\t] );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tprotected matmul( elm2: number[] ) {\r\n\r\n\t\tconst dist = new Array( 16 );\r\n\r\n\t\tfor ( let i = 0; i < 4; i ++ ) {\r\n\r\n\t\t\tfor ( let j = 0; j < 4; j ++ ) {\r\n\r\n\t\t\t\tlet sum = 0;\r\n\r\n\t\t\t\tfor ( let k = 0; k < 4; k ++ ) {\r\n\r\n\t\t\t\t\tsum += this.elm[ k * 4 + j ] * elm2[ k + i * 4 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdist[ j + i * 4 ] = sum;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.elm = dist;\r\n\r\n\t}\r\n\r\n\tpublic multiply( m: Matrix ) {\r\n\r\n\t\tthis.matmul( m.elm );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic preMultiply( m: Matrix ) {\r\n\r\n\t\tconst tmp = this.copyToArray( [] );\r\n\r\n\t\tthis.set( m.elm );\r\n\r\n\t\tthis.matmul( tmp );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic decompose( pos?: IVector3, rot?: Quaternion, scale?: IVector3 ) {\r\n\r\n\t\tif ( pos ) {\r\n\r\n\t\t\tpos.x = this.elm[ 12 ];\r\n\t\t\tpos.y = this.elm[ 13 ];\r\n\t\t\tpos.z = this.elm[ 14 ];\r\n\r\n\t\t}\r\n\r\n\t\tif ( rot ) {\r\n\r\n\t\t\trot.setFromMatrix( this );\r\n\r\n\t\t}\r\n\r\n\t\tif ( scale ) {\r\n\r\n\t\t\t// todo\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic copyToArray( array: number[] ) {\r\n\r\n\t\tarray.length = this.elm.length;\r\n\r\n\t\tfor ( let i = 0; i < this.elm.length; i ++ ) {\r\n\r\n\t\t\tarray[ i ] = this.elm[ i ];\r\n\r\n\t\t}\r\n\r\n\t\treturn array;\r\n\r\n\t}\r\n\r\n}\r\n","import { IVector3, IVector4, Matrix, Types } from \"..\";\r\nimport { Vector } from \"./Vector\";\r\n\r\nexport type Quat = {\r\n\tx: number,\r\n\ty: number,\r\n\tz: number\r\n}\r\n\r\nexport type EulerOrder = 'XYZ' | 'XZY' | 'ZYX' | 'YZX'\r\n\r\nexport class Quaternion {\r\n\r\n\tpublic x: number;\r\n\tpublic y: number;\r\n\tpublic z: number;\r\n\tpublic w: number;\r\n\r\n\tconstructor( x?: number, y?: number, z?: number, w?: number ) {\r\n\r\n\t\tthis.x = 0;\r\n\t\tthis.y = 0;\r\n\t\tthis.z = 0;\r\n\t\tthis.w = 1;\r\n\r\n\t\tthis.set( x, y, z, w );\r\n\r\n\t}\r\n\r\n\tpublic set( x?: number, y?: number, z?: number, w?: number ) {\r\n\r\n\t\tthis.x = x ?? this.x;\r\n\t\tthis.y = y ?? this.y;\r\n\t\tthis.z = z ?? this.z;\r\n\t\tthis.w = w ?? this.w;\r\n\r\n\t}\r\n\r\n\tpublic setFromEuler( euler: Vector | IVector3, order: EulerOrder = 'XYZ' ) {\r\n\r\n\t\tconst sx = Math.sin( euler.x / 2 );\r\n\t\tconst sy = Math.sin( euler.y / 2 );\r\n\t\tconst sz = Math.sin( euler.z / 2 );\r\n\r\n\t\tconst cx = Math.cos( euler.x / 2 );\r\n\t\tconst cy = Math.cos( euler.y / 2 );\r\n\t\tconst cz = Math.cos( euler.z / 2 );\r\n\r\n\t\tif ( order == 'XYZ' ) {\r\n\r\n\t\t\tthis.x = cx * sy * sz + sx * cy * cz;\r\n\t\t\tthis.y = - sx * cy * sz + cx * sy * cz;\r\n\t\t\tthis.z = cx * cy * sz + sx * sy * cz;\r\n\t\t\tthis.w = - sx * sy * sz + cx * cy * cz;\r\n\r\n\t\t} else if ( order == 'XZY' ) {\r\n\r\n\t\t\tthis.x = - cx * sy * sz + sx * cy * cz;\r\n\t\t\tthis.y = cx * sy * cz - sx * cy * sz;\r\n\t\t\tthis.z = sx * sy * cz + cx * cy * sz;\r\n\t\t\tthis.w = sx * sy * sz + cx * cy * cz;\r\n\r\n\t\t} else if ( order == 'YZX' ) {\r\n\r\n\t\t\tthis.x = sx * cy * cz + cx * sy * sz;\r\n\t\t\tthis.y = sx * cy * sz + cx * sy * cz;\r\n\t\t\tthis.z = - sx * sy * cz + cx * cy * sz;\r\n\t\t\tthis.w = - sx * sy * sz + cx * cy * cz;\r\n\r\n\t\t} else if ( order == 'ZYX' ) {\r\n\r\n\t\t\tthis.x = sx * cy * cz - cx * sy * sz;\r\n\t\t\tthis.y = sx * cy * sz + cx * sy * cz;\r\n\t\t\tthis.z = - sx * sy * cz + cx * cy * sz;\r\n\t\t\tthis.w = sx * sy * sz + cx * cy * cz;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t// http://marupeke296.sakura.ne.jp/DXG_No58_RotQuaternionTrans.html\r\n\r\n\tpublic setFromMatrix( matrix: Matrix ) {\r\n\r\n\t\tconst elm = matrix.elm;\r\n\r\n\t\tconst trace = elm[ 0 ] + elm[ 5 ] + elm[ 10 ];\r\n\t\tlet qx, qy, qz, qw;\r\n\r\n\t\tif ( trace > 0 ) {\r\n\r\n\t\t  const s = Math.sqrt( trace + 1.0 ) * 2;\r\n\t\t  qw = 0.25 * s;\r\n\t\t  qx = ( elm[ 6 ] - elm[ 9 ] ) / s;\r\n\t\t  qy = ( elm[ 8 ] - elm[ 2 ] ) / s;\r\n\t\t  qz = ( elm[ 1 ] - elm[ 4 ] ) / s;\r\n\r\n\t\t} else if ( elm[ 0 ] > elm[ 5 ] && elm[ 0 ] > elm[ 10 ] ) {\r\n\r\n\t\t  const s = Math.sqrt( 1.0 + elm[ 0 ] - elm[ 5 ] - elm[ 10 ] ) * 2;\r\n\t\t  qw = ( elm[ 6 ] - elm[ 9 ] ) / s;\r\n\t\t  qx = 0.25 * s;\r\n\t\t  qy = ( elm[ 1 ] + elm[ 4 ] ) / s;\r\n\t\t  qz = ( elm[ 2 ] + elm[ 8 ] ) / s;\r\n\r\n\t\t} else if ( elm[ 5 ] > elm[ 10 ] ) {\r\n\r\n\t\t  const s = Math.sqrt( 1.0 + elm[ 5 ] - elm[ 0 ] - elm[ 10 ] ) * 2;\r\n\t\t  qw = ( elm[ 8 ] - elm[ 2 ] ) / s;\r\n\t\t  qx = ( elm[ 1 ] + elm[ 4 ] ) / s;\r\n\t\t  qy = 0.25 * s;\r\n\t\t  qz = ( elm[ 6 ] + elm[ 9 ] ) / s;\r\n\r\n\t\t} else {\r\n\r\n\t\t  const s = Math.sqrt( 1.0 + elm[ 10 ] - elm[ 0 ] - elm[ 5 ] ) * 2;\r\n\t\t  qw = ( elm[ 1 ] - elm[ 4 ] ) / s;\r\n\t\t  qx = ( elm[ 2 ] + elm[ 8 ] ) / s;\r\n\t\t  qy = ( elm[ 6 ] + elm[ 9 ] ) / s;\r\n\t\t  qz = 0.25 * s;\r\n\r\n\t\t}\r\n\r\n\t\tconst length = Math.sqrt( qx * qx + qy * qy + qz * qz + qw * qw );\r\n\t\tqx /= length;\r\n\t\tqy /= length;\r\n\t\tqz /= length;\r\n\t\tqw /= length;\r\n\r\n\t\tthis.x = qx;\r\n\t\tthis.y = qy;\r\n\t\tthis.z = qz;\r\n\t\tthis.w = qw;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic multiply( q: Quaternion ) {\r\n\r\n\t\tconst w = this.w * q.w - this.x * q.x - this.y * q.y - this.z * q.z;\r\n\t\tconst x = this.w * q.x + this.x * q.w + this.y * q.z - this.z * q.y;\r\n\t\tconst y = this.w * q.y - this.x * q.z + this.y * q.w + this.z * q.x;\r\n\t\tconst z = this.w * q.z + this.x * q.y - this.y * q.x + this.z * q.w;\r\n\r\n\t\tthis.set( x, y, z, w );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic inverse() {\r\n\r\n\t\tthis.set( - this.x, - this.y, - this.z, this.w );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic copy( a: Quaternion | Types.Nullable<IVector4> ) {\r\n\r\n\t\tthis.x = a.x ?? 0;\r\n\t\tthis.y = a.y ?? 0;\r\n\t\tthis.z = a.z ?? 0;\r\n\t\tthis.w = a.w ?? 0;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic clone() {\r\n\r\n\t\treturn new Quaternion( this.x, this.y, this.z, this.w );\r\n\r\n\t}\r\n\r\n}\r\n","import { BufferType } from \"../GLPowerBuffer\";\r\nimport { Power } from \"../Power\";\r\nimport { Attribute, AttributeBuffer } from \"../GLPowerVAO\";\r\n\r\ntype DefaultAttributeName = 'position' | 'uv' | 'normal' | 'index';\r\n\r\nexport class Geometry {\r\n\r\n\tpublic count: number = 0;\r\n\r\n\tpublic attributes: {[key: string]: Attribute} = {};\r\n\r\n\tconstructor() {\r\n\t}\r\n\r\n\tpublic setAttribute( name: DefaultAttributeName | ( string & {} ), array: number[], size: number ) {\r\n\r\n\t\tthis.attributes[ name ] = {\r\n\t\t\tarray,\r\n\t\t\tsize\r\n\t\t};\r\n\r\n\t\tthis.updateVertCount();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic getAttribute( name: DefaultAttributeName | ( string & {} ) ) {\r\n\r\n\t\treturn this.attributes[ name ];\r\n\r\n\t}\r\n\r\n\tprivate updateVertCount() {\r\n\r\n\t\tconst keys = Object.keys( this.attributes );\r\n\r\n\t\tthis.count = keys.length > 0 ? Infinity : 0;\r\n\r\n\t\tkeys.forEach( name => {\r\n\r\n\t\t\tconst attribute = this.attributes[ name ];\r\n\r\n\t\t\tif ( name != 'index' ) {\r\n\r\n\t\t\t\tthis.count = Math.min( attribute.array.length / attribute.size, this.count );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t// ecs\r\n\r\n\tpublic getAttributeBuffer( core: Power, name: DefaultAttributeName | ( string & {} ), constructor: Float32ArrayConstructor | Uint16ArrayConstructor, bufferType: BufferType = 'vbo' ): AttributeBuffer {\r\n\r\n\t\tconst attr = this.getAttribute( name );\r\n\r\n\t\treturn {\r\n\t\t\tbuffer: core.createBuffer().setData( new constructor( attr.array ), bufferType ),\r\n\t\t\tsize: attr.size,\r\n\t\t\tcount: attr.array.length / attr.size\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tpublic getComponent( power: Power ) {\r\n\r\n\t\tconst attributes:( Omit<AttributeBuffer, 'count'> & {name: string} )[] = [];\r\n\r\n\t\tif ( this.getAttribute( 'position' ) ) {\r\n\r\n\t\t\tattributes.push( { name: 'position', ...this.getAttributeBuffer( power, 'position', Float32Array ) } );\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.getAttribute( 'uv' ) ) {\r\n\r\n\t\t\tattributes.push( { name: 'uv', ...this.getAttributeBuffer( power, 'uv', Float32Array ) } );\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.getAttribute( 'normal' ) ) {\r\n\r\n\t\t\tattributes.push( { name: 'normal', ...this.getAttributeBuffer( power, 'normal', Float32Array ) } );\r\n\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tattributes,\r\n\t\t\tindex: this.getAttributeBuffer( power, 'index', Uint16Array, 'ibo' )\r\n\t\t};\r\n\r\n\t}\r\n\r\n}\r\n","import { Power } from '../Power';\r\nimport { Geometry } from './Geometry';\r\n\r\nexport class CubeGeometry extends Geometry {\r\n\r\n\tconstructor( width: number = 1, height: number = 1, depth: number = 1, segmentsWidth: number = 1, segmentsHeight: number = 1, segmentsDepth: number = 1 ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tconst posArray = [];\r\n\t\tconst normalArray = [];\r\n\t\tconst uvArray = [];\r\n\t\tconst indexArray = [];\r\n\t\tconst posYArray = [];\r\n\r\n\t\tconst faces = [\r\n\t\t\t{ normal: [ 0, 0, 1 ], dir: [ 1, 0, 0 ], up: [ 0, 1, 0 ], w: width, h: height, d: depth, segW: segmentsWidth, segH: segmentsHeight },\r\n\t\t\t{ normal: [ 0, 0, - 1 ], dir: [ - 1, 0, 0 ], up: [ 0, 1, 0 ], w: width, h: height, d: depth, segW: segmentsWidth, segH: segmentsHeight },\r\n\t\t\t{ normal: [ 1, 0, 0 ], dir: [ 0, 0, - 1 ], up: [ 0, 1, 0 ], w: depth, h: height, d: width, segW: segmentsDepth, segH: segmentsHeight },\r\n\t\t\t{ normal: [ - 1, 0, 0 ], dir: [ 0, 0, 1 ], up: [ 0, 1, 0 ], w: depth, h: height, d: width, segW: segmentsDepth, segH: segmentsHeight },\r\n\t\t\t{ normal: [ 0, 1, 0 ], dir: [ - 1, 0, 0 ], up: [ 0, 0, 1 ], w: width, h: depth, d: height, segW: segmentsWidth, segH: segmentsDepth },\r\n\t\t\t{ normal: [ 0, - 1, 0 ], dir: [ - 1, 0, 0 ], up: [ 0, 0, - 1 ], w: width, h: depth, d: height, segW: segmentsWidth, segH: segmentsDepth },\r\n\t\t];\r\n\r\n\t\tlet indexOffset = 0;\r\n\r\n\t\tfor ( const face of faces ) {\r\n\r\n\t\t\tconst n = face.normal;\r\n\t\t\tconst dir = face.dir;\r\n\t\t\tconst up = face.up;\r\n\t\t\tconst segW = face.segW;\r\n\t\t\tconst segH = face.segH;\r\n\r\n\t\t\tconst hx = face.w / 2;\r\n\t\t\tconst hy = face.h / 2;\r\n\t\t\tconst hz = face.d / 2;\r\n\r\n\t\t\tconst widthStep = face.w / segW;\r\n\t\t\tconst heightStep = face.h / segH;\r\n\r\n\t\t\tfor ( let i = 0; i <= segH; i ++ ) {\r\n\r\n\t\t\t\tfor ( let j = 0; j <= segW; j ++ ) {\r\n\r\n\t\t\t\t\tconst x = - hx + j * widthStep;\r\n\t\t\t\t\tconst y = - hy + i * heightStep;\r\n\t\t\t\t\tconst z = - hz;\r\n\r\n\t\t\t\t\tconst u = j / segW;\r\n\t\t\t\t\tconst v = i / segH;\r\n\r\n\t\t\t\t\tconst px = x * - dir[ 0 ] + y * up[ 0 ] + z * - n[ 0 ];\r\n\t\t\t\t\tconst py = x * - dir[ 1 ] + y * up[ 1 ] + z * - n[ 1 ];\r\n\t\t\t\t\tconst pz = x * - dir[ 2 ] + y * up[ 2 ] + z * - n[ 2 ];\r\n\r\n\t\t\t\t\tposArray.push( px, py, pz );\r\n\t\t\t\t\tnormalArray.push( ...n );\r\n\t\t\t\t\tuvArray.push( u, v );\r\n\r\n\t\t\t\t\tposYArray.push(\r\n\t\t\t\t\t\ti / segH * up[ 1 ] + ( Math.max( 0.0, up[ 2 ] ) ),\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tif ( i < segH && j < segW ) {\r\n\r\n\t\t\t\t\t\tconst a = indexOffset + i * ( segW + 1 ) + j;\r\n\t\t\t\t\t\tconst b = indexOffset + ( i + 1 ) * ( segW + 1 ) + j;\r\n\t\t\t\t\t\tconst c = indexOffset + ( i + 1 ) * ( segW + 1 ) + ( j + 1 );\r\n\t\t\t\t\t\tconst d = indexOffset + i * ( segW + 1 ) + ( j + 1 );\r\n\r\n\t\t\t\t\t\tindexArray.push( a, b, d );\r\n\t\t\t\t\t\tindexArray.push( b, c, d );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tindexOffset += ( segW + 1 ) * ( segH + 1 );\r\n\r\n\t\t}\r\n\r\n\t\tthis.setAttribute( 'position', posArray, 3 );\r\n\t\tthis.setAttribute( 'normal', normalArray, 3 );\r\n\t\tthis.setAttribute( 'uv', uvArray, 2 );\r\n\t\tthis.setAttribute( 'posY', posYArray, 1 );\r\n\t\tthis.setAttribute( 'index', indexArray, 1 );\r\n\r\n\t}\r\n\r\n\tpublic getComponent( power: Power ) {\r\n\r\n\t\tconst component = super.getComponent( power );\r\n\r\n\t\tcomponent.attributes.push( {\r\n\t\t\tname: 'posY',\r\n\t\t\t...this.getAttributeBuffer( power, \"posY\", Float32Array )\r\n\t\t} );\r\n\r\n\t\treturn component;\r\n\r\n\t}\r\n\r\n}\r\n","import { Geometry } from './Geometry';\r\nimport { Vector } from '../Math/Vector';\r\n\r\nexport class CylinderGeometry extends Geometry {\r\n\r\n\tconstructor( radiusTop: number = 0.5, radiusBottom: number = 0.5, height: number = 1, radSegments: number = 10, heightSegments: number = 1 ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tconst posArray = [];\r\n\t\tconst normalArray = [];\r\n\t\tconst uvArray = [];\r\n\t\tconst indexArray = [];\r\n\r\n\t\t//上下面分2回多くループ\r\n\t\tfor ( let i = 0; i <= heightSegments + 2; i ++ ) {\r\n\r\n\t\t\tfor ( let j = 0; j < radSegments; j ++ ) {\r\n\r\n\t\t\t\tconst theta = Math.PI * 2.0 / radSegments * j;\r\n\r\n\t\t\t\tif ( i <= heightSegments ) {\r\n\r\n\t\t\t\t\t//side\r\n\t\t\t\t\tconst w = i / heightSegments;\r\n\t\t\t\t\tconst radius = ( 1.0 - w ) * radiusBottom + w * radiusTop;\r\n\r\n\t\t\t\t\tconst x = Math.cos( theta ) * radius;\r\n\t\t\t\t\tconst y = - ( height / 2 ) + ( height / heightSegments ) * i;\r\n\t\t\t\t\tconst z = Math.sin( theta ) * radius;\r\n\r\n\t\t\t\t\tposArray.push( x, y, z );\r\n\r\n\t\t\t\t\tuvArray.push(\r\n\t\t\t\t\t\tj / radSegments,\r\n\t\t\t\t\t\ti / heightSegments\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tconst normal = new Vector( Math.cos( theta ), 0, Math.sin( theta ) ).normalize();\r\n\r\n\t\t\t\t\tnormalArray.push(\r\n\t\t\t\t\t\tnormal.x,\r\n\t\t\t\t\t\tnormal.y,\r\n\t\t\t\t\t\tnormal.z\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tif ( i < heightSegments ) {\r\n\r\n\t\t\t\t\t\tindexArray.push(\r\n\t\t\t\t\t\t\ti * radSegments + j,\r\n\t\t\t\t\t\t\t( i + 1 ) * radSegments + ( j + 1 ) % radSegments,\r\n\t\t\t\t\t\t\ti * radSegments + ( j + 1 ) % radSegments,\r\n\r\n\t\t\t\t\t\t\ti * radSegments + j,\r\n\t\t\t\t\t\t\t( i + 1 ) * radSegments + j,\r\n\t\t\t\t\t\t\t( i + 1 ) * radSegments + ( j + 1 ) % radSegments,\r\n\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t//bottom, top\r\n\r\n\t\t\t\t\tconst side = i - heightSegments - 1;\r\n\r\n\t\t\t\t\tconst radius = side ? radiusTop : radiusBottom;\r\n\r\n\t\t\t\t\tconst x = Math.cos( theta ) * radius;\r\n\t\t\t\t\tconst y = - ( height / 2 ) + height * ( side );\r\n\t\t\t\t\tconst z = Math.sin( theta ) * radius;\r\n\r\n\t\t\t\t\tposArray.push( x, y, z );\r\n\r\n\t\t\t\t\tuvArray.push(\r\n\t\t\t\t\t\t( x + radius ) * 0.5 / radius,\r\n\t\t\t\t\t\t( z + radius ) * 0.5 / radius,\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tnormalArray.push( 0, - 1 + side * 2, 0 );\r\n\r\n\t\t\t\t\tconst offset = radSegments * ( heightSegments + ( side + 1 ) );\r\n\r\n\t\t\t\t\tif ( j <= radSegments - 2 ) {\r\n\r\n\t\t\t\t\t\tif ( side == 0 ) {\r\n\r\n\t\t\t\t\t\t\tindexArray.push(\r\n\t\t\t\t\t\t\t\toffset, offset + j, offset + j + 1,\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tindexArray.push(\r\n\t\t\t\t\t\t\t\toffset, offset + j + 1, offset + j\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// let offset = radSegments * heightSegments;\r\n\t\t// for( let i = 2; i < radSegments; i++ ){\r\n\r\n\t\t// \tindexArray.push(\r\n\t\t// \t\t0, i, i - 1,\r\n\t\t// \t\t0 + offset, i + offset, i - 1 + offset,\r\n\t\t// \t);\r\n\r\n\t\t// }\r\n\r\n\t\tthis.setAttribute( 'position', posArray, 3 );\r\n\t\tthis.setAttribute( 'normal', normalArray, 3 );\r\n\t\tthis.setAttribute( 'uv', uvArray, 2 );\r\n\t\tthis.setAttribute( 'index', indexArray, 1 );\r\n\r\n\t}\r\n\r\n}\r\n","import { Geometry } from './Geometry';\r\n\r\nexport class PlaneGeometry extends Geometry {\r\n\r\n\tconstructor( width: number = 1, height: number = 1, widthSegments: number = 1, heightSegments: number = 1 ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tconst hx = width / 2;\r\n\t\tconst hy = height / 2;\r\n\r\n\t\tconst posArray = [];\r\n\t\tconst normalArray = [];\r\n\t\tconst uvArray = [];\r\n\t\tconst indexArray = [];\r\n\r\n\t\tfor ( let i = 0; i <= heightSegments; i ++ ) {\r\n\r\n\t\t\tfor ( let j = 0; j <= widthSegments; j ++ ) {\r\n\r\n\t\t\t\tconst x = ( j / widthSegments );\r\n\t\t\t\tconst y = ( i / widthSegments );\r\n\r\n\t\t\t\tposArray.push(\r\n\t\t\t\t\t- hx + width * x,\r\n\t\t\t\t\t- hy + height * y,\r\n\t\t\t\t\t0\r\n\t\t\t\t);\r\n\r\n\t\t\t\tuvArray.push( x, y );\r\n\r\n\t\t\t\tnormalArray.push( 0, 0, 1 );\r\n\r\n\t\t\t\tif ( i > 0 && j > 0 ) {\r\n\r\n\t\t\t\t\tconst n = ( widthSegments + 1 );\r\n\t\t\t\t\tconst ru = n * i + j;\r\n\t\t\t\t\tconst lb = n * ( i - 1 ) + j - 1;\r\n\r\n\t\t\t\t\tindexArray.push(\r\n\t\t\t\t\t\tru, n * i + j - 1, lb,\r\n\t\t\t\t\t\tru, lb, n * ( i - 1 ) + j,\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.setAttribute( 'position', posArray, 3 );\r\n\t\tthis.setAttribute( 'normal', normalArray, 3 );\r\n\t\tthis.setAttribute( 'uv', uvArray, 2 );\r\n\t\tthis.setAttribute( 'index', indexArray, 1 );\r\n\r\n\t}\r\n\r\n}\r\n","import { Geometry } from './Geometry';\r\nimport { Vector } from '../Math/Vector';\r\n\r\nexport class SphereGeometry extends Geometry {\r\n\r\n\tconstructor( radius: number = 0.5, widthSegments: number = 20, heightSegments: number = 10 ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tconst posArray = [];\r\n\t\tconst normalArray = [];\r\n\t\tconst uvArray = [];\r\n\t\tconst indexArray = [];\r\n\r\n\t\tfor ( let i = 0; i <= heightSegments; i ++ ) {\r\n\r\n\t\t\tconst thetaI = i / heightSegments * Math.PI;\r\n\r\n\t\t\tconst segments = ( i != 0 && i != heightSegments ) ? widthSegments : widthSegments;\r\n\r\n\t\t\tfor ( let j = 0; j < segments; j ++ ) {\r\n\r\n\t\t\t\t// pos\r\n\r\n\t\t\t\tconst thetaJ = j / segments * Math.PI * 2.0;\r\n\t\t\t\tconst widthRadius = Math.sin( thetaI ) * radius;\r\n\r\n\t\t\t\tconst x = Math.cos( thetaJ ) * widthRadius;\r\n\t\t\t\tconst y = - Math.cos( thetaI ) * radius;\r\n\t\t\t\tconst z = - Math.sin( thetaJ ) * widthRadius;\r\n\r\n\t\t\t\tposArray.push( x, y, z );\r\n\r\n\t\t\t\t// uv\r\n\r\n\t\t\t\tuvArray.push(\r\n\t\t\t\t\tj / segments,\r\n\t\t\t\t\ti / heightSegments\r\n\t\t\t\t);\r\n\r\n\t\t\t\t//normal\r\n\r\n\t\t\t\tconst normal = new Vector( x, y, z ).normalize();\r\n\r\n\t\t\t\tnormalArray.push( normal.x, normal.y, normal.z );\r\n\r\n\t\t\t\t// index\r\n\r\n\t\t\t\tindexArray.push(\r\n\t\t\t\t\ti * widthSegments + j,\r\n\t\t\t\t\ti * widthSegments + ( j + 1 ) % widthSegments,\r\n\t\t\t\t\t( i + 1 ) * widthSegments + ( j + 1 ) % widthSegments,\r\n\r\n\t\t\t\t\ti * widthSegments + j,\r\n\t\t\t\t\t( i + 1 ) * widthSegments + ( j + 1 ) % widthSegments,\r\n\t\t\t\t\t( i + 1 ) * widthSegments + j,\r\n\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.setAttribute( 'position', posArray, 3 );\r\n\t\tthis.setAttribute( 'normal', normalArray, 3 );\r\n\t\tthis.setAttribute( 'uv', uvArray, 2 );\r\n\t\tthis.setAttribute( 'index', indexArray, 1 );\r\n\r\n\t}\r\n\r\n\tpublic setAttribute( name: ( 'position' | 'uv' | 'normal' | 'index' ) | ( string & {} ), array: number[], size: number ) {\r\n\r\n\t\tif ( name == 'index' ) {\r\n\r\n\t\t\tarray.forEach( ( item, index ) => {\r\n\r\n\t\t\t\t// クソ\r\n\t\t\t\tarray[ index ] = item % this.count;\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\treturn super.setAttribute( name, array, size );\r\n\r\n\t}\r\n\r\n}\r\n","import { Geometry } from './Geometry';\r\nimport { Vector } from '../Math/Vector';\r\n\r\nexport class TorusGeometry extends Geometry {\r\n\r\n\tconstructor( majorRadius: number = 1, minorRadius: number = 0.4, radialSegments: number = 30, tubularSegments: number = 20 ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tconst posArray = [];\r\n\t\tconst normalArray = [];\r\n\t\tconst uvArray = [];\r\n\t\tconst indexArray = [];\r\n\r\n\t\tfor ( let i = 0; i <= radialSegments; i ++ ) {\r\n\r\n\t\t\tconst thetaI = i / radialSegments * Math.PI * 2;\r\n\r\n\t\t\tfor ( let j = 0; j <= tubularSegments; j ++ ) {\r\n\r\n\t\t\t\tconst thetaJ = j / tubularSegments * Math.PI * 2;\r\n\r\n\t\t\t\t// pos\r\n\r\n\t\t\t\tconst x = ( majorRadius + minorRadius * Math.cos( thetaJ ) ) * Math.cos( thetaI );\r\n\t\t\t\tconst y = minorRadius * Math.sin( thetaJ );\r\n\t\t\t\tconst z = ( majorRadius + minorRadius * Math.cos( thetaJ ) ) * Math.sin( thetaI );\r\n\r\n\t\t\t\tposArray.push( x, y, z );\r\n\r\n\t\t\t\t// uv\r\n\r\n\t\t\t\tuvArray.push(\r\n\t\t\t\t\ti / radialSegments,\r\n\t\t\t\t\tj / tubularSegments\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// normal\r\n\r\n\t\t\t\tconst normal = new Vector(\r\n\t\t\t\t\tMath.cos( thetaI ) * Math.cos( thetaJ ),\r\n\t\t\t\t\tMath.sin( thetaI ) * Math.cos( thetaJ ),\r\n\t\t\t\t\tMath.sin( thetaJ )\r\n\t\t\t\t);\r\n\r\n\t\t\t\tnormalArray.push( normal.x, normal.y, normal.z );\r\n\r\n\t\t\t\t// index\r\n\r\n\t\t\t\tif ( i < radialSegments && j < tubularSegments ) {\r\n\r\n\t\t\t\t\tconst a = i * ( tubularSegments + 1 ) + j;\r\n\t\t\t\t\tconst b = i * ( tubularSegments + 1 ) + j + 1;\r\n\t\t\t\t\tconst c = ( i + 1 ) * ( tubularSegments + 1 ) + j + 1;\r\n\t\t\t\t\tconst d = ( i + 1 ) * ( tubularSegments + 1 ) + j;\r\n\r\n\t\t\t\t\tindexArray.push( a, b, c, a, c, d );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.setAttribute( 'position', posArray, 3 );\r\n\t\tthis.setAttribute( 'normal', normalArray, 3 );\r\n\t\tthis.setAttribute( 'uv', uvArray, 2 );\r\n\t\tthis.setAttribute( 'index', indexArray, 1 );\r\n\r\n\t}\r\n\r\n}\r\n","import { Vector } from '..';\r\nimport { Geometry } from './Geometry';\r\n\r\nexport class MipMapGeometry extends Geometry {\r\n\r\n\tconstructor( count: number = 7 ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.count = count;\r\n\r\n\t\tconst posArray = [];\r\n\t\tconst uvArray = [];\r\n\t\tconst indexArray = [];\r\n\r\n\t\tconst p = new Vector( 0, 0 );\r\n\t\tlet s = 1.0;\r\n\r\n\t\tfor ( let i = 0; i < count; i ++ ) {\r\n\r\n\t\t\tposArray.push( - 1.0 + p.x,\t\t1.0 + p.y,\t\t0 );\r\n\t\t\tposArray.push( - 1.0 + p.x + s, 1.0 + p.y,\t\t0 );\r\n\t\t\tposArray.push( - 1.0 + p.x + s, 1.0 + p.y - s,\t0 );\r\n\t\t\tposArray.push( - 1.0 + p.x,\t\t1.0 + p.y - s, \t0 );\r\n\r\n\t\t\tuvArray.push( 0.0, 1.0 );\r\n\t\t\tuvArray.push( 1.0, 1.0 );\r\n\t\t\tuvArray.push( 1.0, 0.0 );\r\n\t\t\tuvArray.push( 0.0, 0.0 );\r\n\r\n\t\t\tconst indexOffset = ( i + 0.0 ) * 4;\r\n\t\t\tindexArray.push( indexOffset + 0, indexOffset + 2, indexOffset + 1, indexOffset + 0, indexOffset + 3, indexOffset + 2 );\r\n\r\n\t\t\tp.x += s;\r\n\t\t\tp.y = p.y - s;\r\n\r\n\t\t\ts *= 0.5;\r\n\r\n\t\t}\r\n\r\n\t\tthis.setAttribute( 'position', posArray, 3 );\r\n\t\tthis.setAttribute( 'uv', uvArray, 2 );\r\n\t\tthis.setAttribute( 'index', indexArray, 1 );\r\n\r\n\t}\r\n\r\n\r\n}\r\n","import { Component, ComponentName } from \"./Component\";\r\nimport { Entity } from \"./Entity\";\r\nimport { EntityQuery, System } from \"./System\";\r\nimport { World } from \"./World\";\r\n\r\nexport interface ECSUpdateEvent {\r\n\tworld: World,\r\n\ttime: number,\r\n\tdeltaTime: number,\r\n}\r\n\r\nexport namespace ECS {\r\n\r\n\texport const createWorld = (): World => {\r\n\r\n\t\treturn {\r\n\t\t\telapsedTime: 0,\r\n\t\t\tlastUpdateTime: new Date().getTime(),\r\n\t\t\tentitiesTotalCount: 0,\r\n\t\t\tentities: [],\r\n\t\t\tcomponents: new Map(),\r\n\t\t\tsystems: new Map()\r\n\t\t};\r\n\r\n\t};\r\n\r\n\t// entity\r\n\r\n\texport const createEntity = ( world: World ): Entity => {\r\n\r\n\t\tconst entity: Entity = world.entitiesTotalCount ++;\r\n\r\n\t\tworld.entities.push( entity );\r\n\r\n\t\treturn entity;\r\n\r\n\t};\r\n\r\n\texport const removeEntity = ( world: World, entity: Entity ): void =>{\r\n\r\n\t\tconst index = world.entities.findIndex( e => e == entity );\r\n\r\n\t\t// remove entity\r\n\r\n\t\tif ( index > - 1 ) {\r\n\r\n\t\t\tworld.entities.slice( index, 1 );\r\n\r\n\t\t}\r\n\r\n\t\t// remove components\r\n\r\n\t\tworld.components.forEach( component => {\r\n\r\n\t\t\tcomponent[ entity ] = undefined;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t// component\r\n\r\n\texport const addComponent = <T extends Component >( world: World, entity: Entity, componentName: ComponentName, component: T ): T => {\r\n\r\n\t\tlet componentArray = world.components.get( componentName );\r\n\r\n\t\tif ( componentArray === undefined ) {\r\n\r\n\t\t\tcomponentArray = [];\r\n\r\n\t\t\tworld.components.set( componentName, componentArray );\r\n\r\n\t\t}\r\n\r\n\t\tif ( componentArray.length < entity + 1 ) {\r\n\r\n\t\t\tcomponentArray.length = entity + 1;\r\n\r\n\t\t}\r\n\r\n\t\tcomponentArray[ entity ] = component;\r\n\r\n\t\treturn component;\r\n\r\n\t};\r\n\r\n\texport const removeComponent = ( world: World, entity: Entity, componentName: ComponentName ) => {\r\n\r\n\t\tconst componentArray = world.components.get( componentName );\r\n\r\n\t\tif ( componentArray && componentArray.length > entity ) {\r\n\r\n\t\t\tcomponentArray[ entity ] = undefined;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\texport const getComponent = <T extends Component >( world: World, entity: Entity, componentName: ComponentName ): T | null => {\r\n\r\n\t\tconst component = world.components.get( componentName );\r\n\r\n\t\tif ( component !== undefined ) {\r\n\r\n\t\t\treturn ( component[ entity ] ) as T;\r\n\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\r\n\t};\r\n\r\n\t// system\r\n\r\n\texport const addSystem = <T extends System >( world: World, systemName: string, system: T ) => {\r\n\r\n\t\tworld.systems.set( systemName, system );\r\n\r\n\t};\r\n\r\n\texport const removeSystem = ( world: World, componentName: ComponentName ) => {\r\n\r\n\t\tworld.systems.delete( componentName );\r\n\r\n\t};\r\n\r\n\t// update\r\n\r\n\texport const update = ( world: World ) => {\r\n\r\n\t\tconst now = new Date().getTime();\r\n\t\tconst deltaTime = ( now - world.lastUpdateTime ) / 1000;\r\n\t\tworld.elapsedTime += deltaTime;\r\n\t\tworld.lastUpdateTime = now;\r\n\r\n\t\tconst systemList = world.systems;\r\n\r\n\t\tsystemList.forEach( ( system, systemName ) => {\r\n\r\n\t\t\tsystem.update( {\r\n\t\t\t\tsystemName,\r\n\t\t\t\tworld,\r\n\t\t\t\tdeltaTime,\r\n\t\t\t\ttime: world.elapsedTime,\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t// entities\r\n\r\n\texport const getEntities = ( world: World, query: EntityQuery ): Entity[] => {\r\n\r\n\t\tconst entities = world.entities.filter( entt => {\r\n\r\n\t\t\tfor ( let i = 0; i < query.length; i ++ ) {\r\n\r\n\t\t\t\tconst componentName = query[ i ];\r\n\r\n\t\t\t\tconst component = world.components.get( componentName );\r\n\r\n\t\t\t\tif ( component === undefined || component[ entt ] === undefined ) {\r\n\r\n\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t} );\r\n\r\n\t\treturn entities;\r\n\r\n\t};\r\n\r\n}\r\n","\r\ntype ListenerFunction = Function;\r\n\r\ntype Listener = {\r\n\tevent: string,\r\n\tcb: ListenerFunction;\r\n\tonce?: boolean\r\n}\r\n\r\nexport class EventEmitter {\r\n\r\n\tprivate listeners: Listener[];\r\n\r\n\tconstructor() {\r\n\r\n\t\tthis.listeners = [];\r\n\r\n\t}\r\n\r\n\tpublic on( event: string, cb: ListenerFunction ) {\r\n\r\n\t\tthis.listeners.push( {\r\n\t\t\tevent,\r\n\t\t\tcb\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tpublic once( event: string, cb: ListenerFunction ) {\r\n\r\n\t\tthis.listeners.push( {\r\n\t\t\tevent,\r\n\t\t\tcb,\r\n\t\t\tonce: true\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tpublic off( event: string, cb: ListenerFunction ) {\r\n\r\n\t\tthis.listeners = this.listeners.filter( l => {\r\n\r\n\t\t\treturn ! ( l.event == event && l.cb == cb );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tpublic emit( event: string, args?: any[] ) {\r\n\r\n\t\tconst tmpListener = this.listeners.concat();\r\n\r\n\t\tfor ( let i = 0; i < tmpListener.length; i ++ ) {\r\n\r\n\t\t\tconst listener = tmpListener[ i ];\r\n\r\n\t\t\tif ( listener.event == event ) {\r\n\r\n\t\t\t\tlistener.cb.apply( this, args || [] );\r\n\r\n\t\t\t\tif ( listener.once ) {\r\n\r\n\t\t\t\t\tthis.off( event, listener.cb );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n","import { ECS, ECSUpdateEvent } from \"..\";\r\nimport { EventEmitter } from \"../../utils/EventEmitter\";\r\nimport { ComponentName } from \"../Component\";\r\nimport { Entity } from \"../Entity\";\r\n\r\nexport type EntityQuery = ComponentName[]\r\n\r\nexport interface SystemUpdateEvent extends ECSUpdateEvent {\r\n\tsystemName: string\r\n}\r\n\r\nexport class System extends EventEmitter {\r\n\r\n\tprotected queries: {name: string, query: EntityQuery}[];\r\n\r\n\tconstructor( queries?: {[key: string]:EntityQuery} ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.queries = [];\r\n\r\n\t\tif ( queries ) {\r\n\r\n\t\t\tconst keys = Object.keys( queries );\r\n\r\n\t\t\tfor ( let i = 0; i < keys.length; i ++ ) {\r\n\r\n\t\t\t\tconst name = keys[ i ];\r\n\r\n\t\t\t\tthis.queries.push( { name, query: queries[ name ] } );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\r\n\t}\r\n\r\n\tpublic update( event: SystemUpdateEvent ): void {\r\n\r\n\t\tfor ( let i = 0; i < this.queries.length; i ++ ) {\r\n\r\n\t\t\tconst q = this.queries[ i ];\r\n\r\n\t\t\tconst entities = ECS.getEntities( event.world, q.query );\r\n\r\n\t\t\tthis.beforeUpdateImpl( q.name, event, entities );\r\n\r\n\t\t\tfor ( let j = 0; j < entities.length; j ++ ) {\r\n\r\n\t\t\t\tthis.updateImpl( q.name, entities[ j ], event );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.afterUpdateImpl( q.name, event );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tprotected beforeUpdateImpl( logicName: string, event: SystemUpdateEvent, entities: Entity[] ) { // eslint-disable-line\r\n\t}\r\n\r\n\tprotected updateImpl( logicName: string, entity: Entity, event: SystemUpdateEvent ) { // eslint-disable-line\r\n\t}\r\n\r\n\tprotected afterUpdateImpl( logicName: string, event: SystemUpdateEvent ) { // eslint-disable-line\r\n\t}\r\n\r\n\tpublic dispose() {\r\n\r\n\t\tthis.emit( 'dispose' );\r\n\r\n\t}\r\n\r\n}\r\n","\n/*-------------------------------\n\t\tBezier\n-------------------------------*/\n\nexport namespace Bezier {\n\n\texport type BezierControlPoints = {\n\t\tp0: number;\n\t\tp1: number;\n\t\tp2: number;\n\t\tp3: number;\n\t}\n\n\t// inspired https://github.com/gre/bezier-easing/blob/master/src/index.js and https://github.com/0b5vr/automaton/blob/872420e798d9054d4a7a06c972cbb4261a67b4bc/src/bezierEasing.ts\n\n\texport const NEWTON_ITERATIONS = 4;\n\texport const NEWTON_MIN_SLOPE = 0.001;\n\texport const SUBDIVISION_PRECISION = 0.0000001;\n\texport const SUBDIVISION_MAX_ITERATIONS = 10;\n\texport const BEZIER_EASING_CACHE_SIZE = 11;\n\texport const BEZIER_EASING_SAMPLE_STEP_SIZE = 1.0 / BEZIER_EASING_CACHE_SIZE;\n\n\tfunction calcBezierA( p: BezierControlPoints ) {\n\n\t\treturn - p.p0 + 3.0 * p.p1 - 3.0 * p.p2 + p.p3;\n\n\t}\n\tfunction calcBezierB( p: BezierControlPoints ) {\n\n\t\treturn 3.0 * p.p0 - 6.0 * p.p1 + 3.0 * p.p2;\n\n\t}\n\tfunction calcBezierC( p: BezierControlPoints ) {\n\n\t\treturn - 3.0 * p.p0 + 3.0 * p.p1;\n\n\t}\n\n\texport function calcBezierSlope( p: BezierControlPoints, t: number ) {\n\n\t\treturn 3.0 * calcBezierA( p ) * t * t + 2.0 * calcBezierB( p ) * t + calcBezierC( p );\n\n\t}\n\n\texport function calcBezier( p: BezierControlPoints, t: number ) {\n\n\t\treturn ( ( calcBezierA( p ) * t + calcBezierB( p ) ) * t + calcBezierC( p ) ) * t + p.p0;\n\n\t}\n\n\tfunction subdiv( x: number, startT: number, endT: number, p: BezierControlPoints ) {\n\n\t\tlet currentX = 0;\n\t\tlet currentT = 0;\n\n\t\tfor ( let i = 0; i < SUBDIVISION_MAX_ITERATIONS; i ++ ) {\n\n\t\t\tcurrentT = startT + ( endT - startT ) / 2;\n\t\t\tcurrentX = calcBezier( p, currentT );\n\n\t\t\tif ( currentX > x ) {\n\n\t\t\t\tendT = currentT;\n\n\t\t\t} else {\n\n\t\t\t\tstartT = currentT;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn currentT;\n\n\t}\n\n\tfunction newton( x:number, p: BezierControlPoints, t: number ) {\n\n\t\tfor ( let i = 0; i < NEWTON_ITERATIONS; i ++ ) {\n\n\t\t\tconst slope = calcBezierSlope( p, t );\n\n\t\t\tif ( slope == 0.0 ) {\n\n\t\t\t\treturn t;\n\n\t\t\t}\n\n\t\t\tconst currentX = ( calcBezier( p, t ) ) - x;\n\t\t\tt -= currentX / slope;\n\n\t\t}\n\n\t\treturn t;\n\n\t}\n\n\texport function getBezierTfromX( p: BezierControlPoints, x: number, cache: number[] ) {\n\n\t\tp.p1 = Math.max( p.p0, Math.min( p.p3, p.p1 ) );\n\t\tp.p2 = Math.max( p.p0, Math.min( p.p3, p.p2 ) );\n\n\t\tlet sample = 0;\n\n\t\tfor ( let i = 1; i < cache.length; i ++ ) {\n\n\t\t\tsample = i - 1;\n\t\t\tif ( x < cache[ i ] ) break;\n\n\t\t}\n\n\t\tconst t = sample / ( BEZIER_EASING_CACHE_SIZE - 1.0 );\n\t\tconst diff = calcBezierSlope( p, t ) / ( p.p3 - p.p0 );\n\n\t\tif ( diff == 0.0 ) {\n\n\t\t\treturn t;\n\n\t\t} else if ( diff > 0.01 ) {\n\n\t\t\treturn newton( x, p, t );\n\n\t\t} else {\n\n\t\t\treturn subdiv( x, t, t + BEZIER_EASING_SAMPLE_STEP_SIZE, p );\n\n\t\t}\n\n\n\t}\n\n}\n","import { IVector2 } from \"..\";\nimport { Bezier } from \"./Bezier\";\n\nexport type EasingFunc = ( t: number ) => any\n\nexport namespace Easings {\n\n\texport function sigmoid( weight: number = 6 ): EasingFunc {\n\n\t\treturn ( x: number ) => {\n\n\t\t\tvar e1 = Math.exp( - weight * ( 2 * x - 1 ) );\n\t\t\tvar e2 = Math.exp( - weight );\n\n\t\t\treturn ( 1 + ( 1 - e1 ) / ( 1 + e1 ) * ( 1 + e2 ) / ( 1 - e2 ) ) / 2;\n\n\t\t};\n\n\t}\n\n\texport function smoothstep( min: number, max: number, value: number ): number {\n\n\t\tconst x = Math.max( 0, Math.min( 1, ( value - min ) / ( max - min ) ) );\n\t\treturn x * x * ( 3 - 2 * x );\n\n\t}\n\n\t/*\n\t@auther https://gist.github.com/gre/1650294\n\t*/\n\n\texport function linear( t: number ) {\n\n\t\treturn t;\n\n\t}\n\n\texport function easeInQuad( t: number ) {\n\n\t\treturn t * t;\n\n\t}\n\n\texport function easeOutQuad( t: number ) {\n\n\t\treturn t * ( 2 - t );\n\n\t}\n\n\texport function easeInOutQuad( t: number ) {\n\n\t\treturn t < .5 ? 2 * t * t : - 1 + ( 4 - 2 * t ) * t;\n\n\t}\n\n\texport function easeInCubic( t: number ) {\n\n\t\treturn t * t * t;\n\n\t}\n\n\texport function easeOutCubic( t: number ) {\n\n\t\treturn ( -- t ) * t * t + 1;\n\n\t}\n\n\texport function easeInOutCubic( t: number ) {\n\n\t\treturn t < .5 ? 4 * t * t * t : ( t - 1 ) * ( 2 * t - 2 ) * ( 2 * t - 2 ) + 1;\n\n\t}\n\n\texport function easeInQuart( t: number ) {\n\n\t\treturn t * t * t * t;\n\n\t}\n\n\texport function easeOutQuart( t: number ) {\n\n\t\treturn 1 - ( -- t ) * t * t * t;\n\n\t}\n\n\texport function easeInOutQuart( t: number ) {\n\n\t\treturn t < .5 ? 8 * t * t * t * t : 1 - 8 * ( -- t ) * t * t * t;\n\n\t}\n\n\texport function easeInQuint( t: number ) {\n\n\t\treturn t * t * t * t * t;\n\n\t}\n\n\texport function easeOutQuint( t: number ) {\n\n\t\treturn 1 + ( -- t ) * t * t * t * t;\n\n\t}\n\n  \texport function easeInOutQuint( t: number ) {\n\n  \t\treturn t < .5 ? 16 * t * t * t * t * t : 1 + 16 * ( -- t ) * t * t * t * t;\n\n  \t}\n\n\texport function bezier( c1: IVector2, h1: IVector2, h2: IVector2, c2: IVector2 ): EasingFunc {\n\n\t\tvar cache = new Array( Bezier.BEZIER_EASING_CACHE_SIZE );\n\n\t\tfor ( var i = 0; i < Bezier.BEZIER_EASING_CACHE_SIZE; ++ i ) {\n\n\t\t\tcache[ i ] = Bezier.calcBezier( { p0: c1.x, p1: h1.x, p2: h2.x, p3: c2.x }, i / ( Bezier.BEZIER_EASING_CACHE_SIZE - 1.0 ) );\n\n\t\t}\n\n\t\treturn ( x: number ) => {\n\n\t\t\tif ( x <= c1.x ) return c1.y;\n\t\t\tif ( c2.x <= x ) return c2.y;\n\n\t\t\treturn Bezier.calcBezier( { p0: c1.y, p1: h1.y, p2: h2.y, p3: c2.y }, Bezier.getBezierTfromX( { p0: c1.x, p1: h1.x, p2: h2.x, p3: c2.x }, x, cache ) );\n\n\t\t};\n\n\t}\n\n\texport function cubicBezier( h1X: number, h1Y: number, h2X: number, h2Y: number ) {\n\n\t\treturn bezier(\n\t\t\t{ x: 0.0, y: 0.0 },\n\t\t\t{ x: h1X, y: h1Y },\n\t\t\t{ x: h2X, y: h2Y },\n\t\t\t{ x: 1.0, y: 1.0 },\n\t\t);\n\n\t}\n\n}\n","import { FCurveKeyFrame } from './FCurveKeyFrame';\r\nimport { EventEmitter } from '../utils/EventEmitter';\r\n\r\nexport class FCurve extends EventEmitter {\r\n\r\n\tpublic keyframes: FCurveKeyFrame[] = [];\r\n\r\n\tprivate cache: { frame: number, value: number } = { frame: NaN, value: NaN };\r\n\r\n\tpublic frameStart: number;\r\n\tpublic frameEnd: number;\r\n\tpublic frameDuration: number;\r\n\r\n\tconstructor( frames?: FCurveKeyFrame[] ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.frameStart = 0;\r\n\t\tthis.frameEnd = 0;\r\n\t\tthis.frameDuration = 0;\r\n\r\n\t\tthis.set( frames );\r\n\r\n\t}\r\n\r\n\tpublic set( frames?: FCurveKeyFrame[] ) {\r\n\r\n\t\tif ( frames ) {\r\n\r\n\t\t\tthis.keyframes.length = 0;\r\n\r\n\t\t\tframes.forEach( keyframe => {\r\n\r\n\t\t\t\tthis.addKeyFrame( keyframe );\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic addKeyFrame( keyframe: FCurveKeyFrame ) {\r\n\r\n\t\tlet index = 0;\r\n\r\n\t\tfor ( let i = 0; i < this.keyframes.length; i ++ ) {\r\n\r\n\t\t\tconst frame = this.keyframes[ i ];\r\n\r\n\t\t\tif ( frame.coordinate.x < keyframe.coordinate.x ) {\r\n\r\n\t\t\t\tindex ++;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.keyframes.splice( index, 0, keyframe );\r\n\r\n\t\t// set frame info\r\n\r\n\t\tthis.frameStart = this.keyframes[ 0 ].coordinate.x;\r\n\t\tthis.frameEnd = this.keyframes[ this.keyframes.length - 1 ].coordinate.x;\r\n\r\n\t}\r\n\r\n\tpublic getValue( frame: number ) {\r\n\r\n\t\tif ( frame == this.cache.frame ) {\r\n\r\n\t\t\treturn this.cache.value;\r\n\r\n\t\t}\r\n\r\n\t\tlet value: number | null = null;\r\n\r\n\t\tfor ( let i = 0; i < this.keyframes.length; i ++ ) {\r\n\r\n\t\t\tconst keyframe = this.keyframes[ i ];\r\n\r\n\t\t\tif ( frame < keyframe.coordinate.x ) {\r\n\r\n\t\t\t\tconst beforeKeyFrame = this.keyframes[ i - 1 ];\r\n\r\n\t\t\t\tif ( beforeKeyFrame ) {\r\n\r\n\t\t\t\t\tvalue = beforeKeyFrame.to( keyframe, frame );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tvalue = keyframe.coordinate.y;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( value === null && this.keyframes.length > 0 ) {\r\n\r\n\t\t\tvalue = this.keyframes[ this.keyframes.length - 1 ].coordinate.y;\r\n\r\n\t\t}\r\n\r\n\t\tif ( value !== null ) {\r\n\r\n\t\t\tthis.cache = {\r\n\t\t\t\tframe: frame,\r\n\t\t\t\tvalue: value\r\n\t\t\t};\r\n\r\n\t\t\treturn value;\r\n\r\n\t\t}\r\n\r\n\t\treturn 0;\r\n\r\n\t}\r\n\r\n}\r\n","import { Types, Vector } from '..';\r\nimport { FCurve } from './FCurve';\r\nimport { EventEmitter } from '../utils/EventEmitter';\r\n\r\nexport class FCurveGroup extends EventEmitter {\r\n\r\n\tpublic name: string;\r\n\r\n\tprivate curves: Map<Types.RecommendString<Types.Axis>, FCurve>;\r\n\r\n\tpublic frameStart: number;\r\n\tpublic frameEnd: number;\r\n\tpublic frameDuration: number;\r\n\tprivate updatedFrame: number = - 1;\r\n\r\n\tpublic value: Vector;\r\n\r\n\tconstructor( name?: string, x?: FCurve, y?: FCurve, z?: FCurve, w?: FCurve ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.name = name || '';\r\n\r\n\t\tthis.frameStart = 0;\r\n\t\tthis.frameEnd = 0;\r\n\t\tthis.frameDuration = 0;\r\n\r\n\t\tthis.curves = new Map();\r\n\r\n\t\tthis.value = new Vector();\r\n\r\n\t\tif ( x ) this.setFCurve( x, 'x' );\r\n\t\tif ( y ) this.setFCurve( y, 'y' );\r\n\t\tif ( z ) this.setFCurve( z, 'z' );\r\n\t\tif ( w ) this.setFCurve( w, 'w' );\r\n\r\n\t}\r\n\r\n\tpublic setFCurve( curve: FCurve, axis: Types.RecommendString<Types.Axis> ) {\r\n\r\n\t\tthis.curves.set( axis, curve );\r\n\r\n\t\tlet minStart = Infinity;\r\n\t\tlet maxEnd = - Infinity;\r\n\r\n\t\tthis.curves.forEach( curve => {\r\n\r\n\t\t\tif ( curve.frameStart < minStart ) {\r\n\r\n\t\t\t\tminStart = curve.frameStart;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( curve.frameEnd > maxEnd ) {\r\n\r\n\t\t\t\tmaxEnd = curve.frameEnd;\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tif ( minStart == - Infinity || maxEnd == Infinity ) {\r\n\r\n\t\t\tminStart = 0;\r\n\t\t\tmaxEnd = 1;\r\n\r\n\t\t}\r\n\r\n\t\tthis.frameStart = minStart;\r\n\t\tthis.frameEnd = maxEnd;\r\n\t\tthis.frameDuration = this.frameEnd - this.frameStart;\r\n\r\n\t}\r\n\r\n\tpublic getFCurve( axis: Types.RecommendString<Types.Axis> ) {\r\n\r\n\t\treturn this.curves.get( axis ) || null;\r\n\r\n\t}\r\n\r\n\tpublic setFrame( frame: number ) {\r\n\r\n\t\tif ( frame == this.updatedFrame ) return this;\r\n\r\n\t\tconst x = this.curves.get( 'x' );\r\n\t\tconst y = this.curves.get( 'y' );\r\n\t\tconst z = this.curves.get( 'z' );\r\n\t\tconst w = this.curves.get( 'w' );\r\n\r\n\t\tif ( x ) this.value.x = x.getValue( frame );\r\n\t\tif ( y ) this.value.y = y.getValue( frame );\r\n\t\tif ( z ) this.value.z = z.getValue( frame );\r\n\t\tif ( w ) this.value.w = w.getValue( frame );\r\n\r\n\t\tthis.updatedFrame = frame;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n","import { IVector2 } from '../Math/Vector';\r\nimport { EasingFunc, Easings } from './Easings';\r\nimport { EventEmitter } from '../utils/EventEmitter';\r\n\r\nexport type FCurveInterpolation = \"BEZIER\" | \"LINEAR\" | \"CONSTANT\";\r\n\r\nexport class FCurveKeyFrame extends EventEmitter {\r\n\r\n\tpublic coordinate: IVector2 = { x: 0, y: 0 };\r\n\tpublic handleLeft: IVector2 = { x: 0, y: 0 };\r\n\tpublic handleRight: IVector2 = { x: 0, y: 0 };\r\n\tpublic interpolation: FCurveInterpolation = 'BEZIER';\r\n\r\n\tprivate easing: EasingFunc | null = null;\r\n\tprivate nextFrame: FCurveKeyFrame | null = null;\r\n\r\n\tconstructor( coordinate: IVector2, handleLeft?: IVector2, handleRight?: IVector2, interpolation?: FCurveInterpolation ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.set( coordinate, handleLeft, handleRight, interpolation );\r\n\r\n\t}\r\n\r\n\tpublic set( coordinate: IVector2, handleLeft?: IVector2, handleRight?: IVector2, interpolation?: FCurveInterpolation ) {\r\n\r\n\t\tthis.coordinate = coordinate;\r\n\t\tthis.handleLeft = handleLeft || coordinate;\r\n\t\tthis.handleRight = handleRight || coordinate;\r\n\t\tthis.interpolation = interpolation || 'BEZIER';\r\n\r\n\t}\r\n\r\n\tprivate getEasing( interpolation: FCurveInterpolation, nextFrame: FCurveKeyFrame ) {\r\n\r\n\t\tif ( interpolation == 'BEZIER' ) {\r\n\r\n\t\t\treturn Easings.bezier( this.coordinate, this.handleRight, nextFrame.handleLeft, nextFrame.coordinate );\r\n\r\n\t\t} else if ( interpolation == 'CONSTANT' ) {\r\n\r\n\t\t\treturn () => {\r\n\r\n\t\t\t\treturn this.coordinate.y;\r\n\r\n\t\t\t};\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn ( t: number ) => {\r\n\r\n\t\t\t\tconst d = ( nextFrame.coordinate.y - this.coordinate.y );\r\n\t\t\t\tt = ( t - this.coordinate.x ) / ( nextFrame.coordinate.x - this.coordinate.x );\r\n\r\n\t\t\t\treturn this.coordinate.y + t * d;\r\n\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic to( nextFrame: FCurveKeyFrame, t: number ) {\r\n\r\n\t\tif ( this.nextFrame == null || this.nextFrame.coordinate.x != nextFrame.coordinate.x || this.nextFrame.coordinate.y != nextFrame.coordinate.y ) {\r\n\r\n\t\t\tthis.easing = this.getEasing( this.interpolation, nextFrame );\r\n\t\t\tthis.nextFrame = nextFrame;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.easing ) {\r\n\r\n\t\t\treturn this.easing( t );\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn 0;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n","import { EventEmitter } from '../utils/EventEmitter';\r\nimport { IVector2, IVector3, Vector } from \"../Math/Vector\";\r\nimport { FCurve } from \"../Animation/FCurve\";\r\nimport { FCurveGroup } from '../Animation/FCurveGroup';\r\nimport { FCurveInterpolation, FCurveKeyFrame } from \"../Animation/FCurveKeyFrame\";\r\n\r\n// object\r\n\r\nexport type BLidgeObjectMessage = {\r\n\tn: string,\r\n\tprnt: string,\r\n\tchld?: BLidgeObjectMessage[],\r\n\tanim?: BLidgeAnimation,\r\n\tps: IVector3,\r\n\trt?: IVector3,\r\n\tsc?: IVector3,\r\n\tmat?: {\r\n\t\tn?: string,\r\n\t\tuni?: BLidgeAnimation\r\n\t}\r\n\tt: BLidgeObjectType,\r\n\tv: boolean,\r\n\tprm?: BLidgeCameraParam | BLidgeMeshParam | BLidgeLightParamCommon\r\n}\r\n\r\nexport type BLidgeObject = {\r\n\tname: string,\r\n\tparent: string,\r\n\tchildren: BLidgeObject[],\r\n\tanimation: BLidgeAnimation,\r\n\tposition: IVector3,\r\n\trotation: IVector3,\r\n\tscale: IVector3,\r\n\tmaterial: BLidgeMaterialParam\r\n\ttype: BLidgeObjectType,\r\n\tvisible: boolean,\r\n\tparam?: BLidgeCameraParam | BLidgeMeshParam | BLidgeLightParamCommon\r\n}\r\n\r\nexport type BLidgeObjectType = 'empty' | 'cube' | 'sphere' | 'cylinder' | 'mesh' | 'camera' | 'plane' | 'light';\r\n\r\nexport type BLidgeCameraParam = {\r\n\tfov: number\r\n}\r\n\r\nexport type BLidgeMeshParam = {\r\n\tposition: number[],\r\n\tuv: number[],\r\n\tnormal: number[],\r\n\tindex: number[],\r\n}\r\n\r\nexport type BLidgeLightParam = BLidgeDirectionalLightParam | BLidgeSpotLightParam;\r\n\r\ntype BLidgeLightParamCommon = {\r\n\ttype: 'directional' | 'spot'\r\n\tcolor: IVector3,\r\n\tintensity: number,\r\n\tshadowMap: boolean,\r\n}\r\n\r\nexport type BLidgeDirectionalLightParam = {\r\n\ttype: 'directional'\r\n} & BLidgeLightParamCommon\r\n\r\nexport type BLidgeSpotLightParam = {\r\n\ttype: 'spot',\r\n\tangle: number,\r\n\tblend: number,\r\n} & BLidgeLightParamCommon\r\n\r\n// material\r\n\r\nexport type BLidgeMaterialParam = {\r\n\tname: string,\r\n\tuniforms: BLidgeAnimation\r\n}\r\n\r\n// scene\r\n\r\nexport type BLidgeSceneData = {\r\n    animations: {[key: string]: BLidgeAnimationCurveParam[]};\r\n\tscene: BLidgeObjectMessage;\r\n\tframe: BLidgeSceneFrame;\r\n}\r\n\r\n// animation\r\n\r\nexport type BLidgeAnimation = { [key: string]: string }\r\n\r\nexport type BLidgeAnimationCurveAxis = 'x' | 'y' | 'z' | 'w'\r\n\r\nexport type BLidgeAnimationCurveParam = {\r\n    k: BLidgeAnimationCurveKeyFrameParam[];\r\n\taxis: BLidgeAnimationCurveAxis\r\n}\r\n\r\nexport type BLidgeAnimationCurveKeyFrameParam = {\r\n    c: IVector2;\r\n    h_l?: IVector2;\r\n    h_r?: IVector2;\r\n    e: string;\r\n    i: \"B\" | \"L\" | \"C\";\r\n}\r\n\r\n// message\r\n\r\nexport type BLidgeMessage = BLidgeSyncSceneMessage | BLidgeSyncFrameMessage\r\n\r\nexport type BLidgeSyncSceneMessage = {\r\n\ttype: \"sync/scene\",\r\n    data: BLidgeSceneData;\r\n}\r\n\r\nexport type BLidgeSyncFrameMessage = {\r\n\ttype: \"sync/timeline\";\r\n\tdata: BLidgeSceneFrame;\r\n}\r\n\r\nexport type BLidgeSceneFrame = {\r\n\tstart: number;\r\n\tend: number;\r\n\tcurrent: number;\r\n\tfps: number;\r\n\tplaying: boolean;\r\n}\r\n\r\nexport class BLidge extends EventEmitter {\r\n\r\n\t// ws\r\n\r\n\tprivate url?: string;\r\n\tprivate ws?: WebSocket;\r\n\tpublic connected: boolean = false;\r\n\r\n\t// frame\r\n\r\n\tpublic frame: BLidgeSceneFrame = {\r\n\t\tstart: - 1,\r\n\t\tend: - 1,\r\n\t\tcurrent: - 1,\r\n\t\tfps: - 1,\r\n\t\tplaying: false,\r\n\t};\r\n\r\n\t// animation\r\n\r\n\tpublic objects: BLidgeObject[] = [];\r\n\tpublic curveGroups: FCurveGroup[] = [];\r\n\tpublic scene: BLidgeObject | null;\r\n\r\n\tconstructor( url?: string ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.scene = null;\r\n\r\n\t\tif ( url ) {\r\n\r\n\t\t\tthis.url = url;\r\n\t\t\tthis.connect( this.url );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic connect( url: string ) {\r\n\r\n\t\tthis.url = url;\r\n\t\tthis.ws = new WebSocket( this.url );\r\n\t\tthis.ws.onopen = this.onOpen.bind( this );\r\n\t\tthis.ws.onmessage = this.onMessage.bind( this );\r\n\t\tthis.ws.onclose = this.onClose.bind( this );\r\n\r\n\t\tthis.ws.onerror = ( e ) => {\r\n\r\n\t\t\tconsole.error( e );\r\n\r\n\t\t\tthis.emit( 'error' );\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tpublic loadJsonScene( jsonPath: string ) {\r\n\r\n\t\tconst req = new XMLHttpRequest();\r\n\r\n\t\treq.onreadystatechange = () => {\r\n\r\n\t\t\tif ( req.readyState == 4 ) {\r\n\r\n\t\t\t\tif ( req.status == 200 ) {\r\n\r\n\t\t\t\t\tthis.loadScene( JSON.parse( req.response ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\treq.open( 'GET', jsonPath );\r\n\t\treq.send( );\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tEvents\r\n\t-------------------------------*/\r\n\r\n\tpublic loadScene( data: BLidgeSceneData ) {\r\n\r\n\t\t// frame\r\n\r\n\t\tthis.frame.start = data.frame.start;\r\n\t\tthis.frame.end = data.frame.end;\r\n\t\tthis.frame.fps = data.frame.fps;\r\n\r\n\t\tthis.curveGroups.length = 0;\r\n\t\tthis.objects.length = 0;\r\n\r\n\t\t// actions\r\n\r\n\t\tconst fcurveGroupNames = Object.keys( data.animations );\r\n\r\n\t\tfor ( let i = 0; i < fcurveGroupNames.length; i ++ ) {\r\n\r\n\t\t\tconst fcurveGroupName = fcurveGroupNames[ i ];\r\n\t\t\tconst fcurveGroup = new FCurveGroup( fcurveGroupName );\r\n\r\n\t\t\tdata.animations[ fcurveGroupName ].forEach( fcurveData => {\r\n\r\n\t\t\t\tconst curve = new FCurve();\r\n\r\n\t\t\t\tcurve.set( fcurveData.k.map( frame => {\r\n\r\n\t\t\t\t\tconst interpolation = {\r\n\t\t\t\t\t\t\"B\": \"BEZIER\",\r\n\t\t\t\t\t\t\"C\": \"CONSTANT\",\r\n\t\t\t\t\t\t\"L\": \"LINEAR\",\r\n\t\t\t\t\t}[ frame.i ];\r\n\r\n\t\t\t\t\treturn new FCurveKeyFrame( frame.c, frame.h_l, frame.h_r, interpolation as FCurveInterpolation );\r\n\r\n\t\t\t\t} ) );\r\n\r\n\t\t\t\tfcurveGroup.setFCurve( curve, fcurveData.axis );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tthis.curveGroups.push( fcurveGroup );\r\n\r\n\t\t}\r\n\r\n\t\t// objects\r\n\r\n\t\tthis.objects.length = 0;\r\n\r\n\t\tconst _ = ( objMsg: BLidgeObjectMessage ): BLidgeObject => {\r\n\r\n\t\t\tconst mat = { name: '', uniforms: {} };\r\n\r\n\t\t\tif ( objMsg.mat ) {\r\n\r\n\t\t\t\tmat.name = objMsg.mat.n || '';\r\n\t\t\t\tmat.uniforms = objMsg.mat.uni || {};\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconst obj: BLidgeObject = {\r\n\t\t\t\tname: objMsg.n,\r\n\t\t\t\tparent: objMsg.prnt,\r\n\t\t\t\tchildren: [],\r\n\t\t\t\tanimation: objMsg.anim || {},\r\n\t\t\t\tposition: objMsg.ps || new Vector(),\r\n\t\t\t\trotation: objMsg.rt || new Vector(),\r\n\t\t\t\tscale: objMsg.sc || new Vector(),\r\n\t\t\t\tmaterial: mat,\r\n\t\t\t\ttype: objMsg.t,\r\n\t\t\t\tvisible: objMsg.v,\r\n\t\t\t\tparam: objMsg.prm\r\n\t\t\t};\r\n\r\n\t\t\tif ( objMsg.chld ) {\r\n\r\n\t\t\t\tobjMsg.chld.forEach( item => {\r\n\r\n\t\t\t\t\tobj.children.push( _( item ) );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.objects.push( obj );\r\n\r\n\t\t\treturn obj;\r\n\r\n\t\t};\r\n\r\n\t\tthis.scene = _( data.scene );\r\n\r\n\t\t// dispatch event\r\n\r\n\t\tthis.emit( 'sync/scene', [ this ] );\r\n\r\n\t}\r\n\r\n\tprivate onSyncTimeline( data: BLidgeSceneFrame ) {\r\n\r\n\t\tthis.frame = data;\r\n\r\n\t\tthis.emit( 'sync/timeline', [ this.frame ] );\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tWS Events\r\n\t-------------------------------*/\r\n\r\n\tprivate onOpen( event: Event ) {\r\n\r\n\t\tthis.connected = true;\r\n\r\n\t}\r\n\r\n\tprivate onMessage( e: MessageEvent ) {\r\n\r\n\t\tconst msg = JSON.parse( e.data ) as BLidgeMessage;\r\n\r\n\t\tif ( msg.type == 'sync/scene' ) {\r\n\r\n\t\t\tthis.loadScene( msg.data );\r\n\r\n\t\t} else if ( msg.type == \"sync/timeline\" ) {\r\n\r\n\t\t\tthis.onSyncTimeline( msg.data );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tprivate onClose( e:CloseEvent ) {\r\n\r\n\t\tthis.disposeWS();\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tAPI\r\n\t-------------------------------*/\r\n\r\n\tpublic getCurveGroup( name: string ) {\r\n\r\n\t\treturn this.curveGroups.find( curve => curve.name == name );\r\n\r\n\t}\r\n\r\n\tpublic setFrame( frame: number ) {\r\n\r\n\t\tthis.onSyncTimeline( {\r\n\t\t\t...this.frame,\r\n\t\t\tplaying: true,\r\n\t\t\tcurrent: frame,\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tDispose\r\n\t-------------------------------*/\r\n\r\n\tpublic dispose() {\r\n\r\n\t\tthis.disposeWS();\r\n\r\n\t}\r\n\r\n\tpublic disposeWS() {\r\n\r\n\t\tif ( this.ws ) {\r\n\r\n\t\t\tthis.ws.close();\r\n\t\t\tthis.ws.onmessage = null;\r\n\t\t\tthis.ws.onclose = null;\r\n\t\t\tthis.ws.onopen = null;\r\n\r\n\t\t\tthis.connected = false;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n","import { Uniforms } from \"../GLPowerProgram\";\r\n\r\nexport namespace UniformsUtils {\r\n\r\n\texport function merge( ...uniforms: ( Uniforms|undefined )[] ) : Uniforms {\r\n\r\n\t\tconst res = {};\r\n\r\n\t\tfor ( let i = 0; i < uniforms.length; i ++ ) {\r\n\r\n\t\t\tif ( uniforms[ i ] != undefined ) {\r\n\r\n\t\t\t\tObject.assign( res, uniforms[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn res;\r\n\r\n\t}\r\n\r\n}\r\n"],"names":["GLPowerVAO","gl","program","name","buffer","size","opt","attr","count","force","attribute","indexBuffer","cb","item","GLPowerProgram","vertexShaderSrc","fragmentShaderSrc","vs","fs","shaderSrc","type","shader","error","t","i","value","uniform","key","id","vao","GLPowerBuffer","data","usage","target","Vector","x","y","z","w","a","_a","_b","_c","_d","v","ax","ay","az","bx","by","bz","mat","elm","e11","e12","e13","e21","e22","e23","e31","e32","e33","xx","yy","zz","e14","e24","e34","e41","e42","e43","e44","ww","GLPowerTexture","param","img","unitNumber","src","callBack","resolve","reject","GLPowerFrameBuffer","renderBuffer","textures","attachment","width_size","height","Power","GLPowerTransformFeedback","varyingIndex","fbBuffer","Matrix","fov","aspect","near","far","d","width","eye","up","zAxis","xAxis","yAxis","b","c","e","f","g","h","j","k","l","m","n","o","p","q","r","s","u","A","B","det","ivd","pos","qua","scale","position","xy","xz","xw","yz","yw","zw","elm2","dist","sum","tmp","rot","array","Quaternion","euler","order","sx","sy","sz","cx","cy","cz","matrix","trace","qx","qy","qz","qw","length","Geometry","keys","core","constructor","bufferType","power","attributes","CubeGeometry","depth","segmentsWidth","segmentsHeight","segmentsDepth","posArray","normalArray","uvArray","indexArray","posYArray","faces","indexOffset","face","dir","segW","segH","hx","hy","hz","widthStep","heightStep","px","py","pz","component","CylinderGeometry","radiusTop","radiusBottom","radSegments","heightSegments","theta","radius","normal","side","offset","PlaneGeometry","widthSegments","ru","lb","SphereGeometry","thetaI","segments","thetaJ","widthRadius","index","TorusGeometry","majorRadius","minorRadius","radialSegments","tubularSegments","MipMapGeometry","ECS","world","entity","componentName","componentArray","systemName","system","now","deltaTime","query","entt","EventEmitter","event","args","tmpListener","listener","System","queries","entities","logicName","Bezier","calcBezierA","calcBezierB","calcBezierC","calcBezierSlope","calcBezier","subdiv","startT","endT","currentX","currentT","newton","slope","getBezierTfromX","cache","sample","diff","Easings","sigmoid","weight","e1","e2","smoothstep","min","max","linear","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","bezier","c1","h1","h2","c2","cubicBezier","h1X","h1Y","h2X","h2Y","FCurve","frames","keyframe","frame","beforeKeyFrame","FCurveGroup","curve","axis","minStart","maxEnd","FCurveKeyFrame","coordinate","handleLeft","handleRight","interpolation","nextFrame","BLidge","url","jsonPath","req","fcurveGroupNames","fcurveGroupName","fcurveGroup","fcurveData","_","objMsg","obj","msg","UniformsUtils","merge","uniforms","res"],"mappings":"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"}